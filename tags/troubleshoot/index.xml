<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>– troubleshoot</title><link>https://docs.trustgrid.io/tags/troubleshoot/</link><description>Recent content in troubleshoot on</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Wed, 28 Dec 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://docs.trustgrid.io/tags/troubleshoot/index.xml" rel="self" type="application/rss+xml"/><item><title>Tutorials: Operations Runbook</title><link>https://docs.trustgrid.io/tutorials/operations-runbook/</link><pubDate>Wed, 28 Dec 2022 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/operations-runbook/</guid><description/></item><item><title>Tutorials: Cluster Failover Response</title><link>https://docs.trustgrid.io/tutorials/operations-runbook/cluster-failover-response/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/operations-runbook/cluster-failover-response/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>When the active (master) member of the &lt;a href="https://docs.trustgrid.io/docs/clusters/">cluster&lt;/a> goes unhealthy the standby member will take over the active role. This process should be automatic and not require manual intervention. However, in certain circumstances, such as the unexpected failover of a public gateway, it is worth investigating to confirm traffic is in a healthy state.&lt;/p>
&lt;/div>
&lt;h3 id="possible-messages">Possible Messages&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>Master role assumed - failover&lt;/p>
&lt;ul>
&lt;li>Indicates the master role has moved from the designated master (primary) to the backup/secondary &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Master role reclaimed by expected master&lt;/p>
&lt;ul>
&lt;li>Indicates the master role has returned to the designated master&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="failover-process">Failover Process&lt;/h3>
&lt;p>Below is a brief description events that occur during a failover process:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>The &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> assuming the master role will ARP to the network that it now owns the &lt;a href="https://docs.trustgrid.io/docs/clusters/">Cluster&lt;/a> Virtual IP (VIP)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The &lt;a href="https://docs.trustgrid.io/docs/domain/virtual-networks/routes/">Domain route&lt;/a> table will update that the assuming &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> should receive all traffic for the &lt;a href="https://docs.trustgrid.io/docs/clusters/">cluster&lt;/a> (&lt;em>clustername-master&lt;/em>)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>The assuming &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> will load all NAT entries associated with the &lt;a href="https://docs.trustgrid.io/docs/clusters/">cluster&lt;/a>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="response-process">Response Process&lt;/h3>
&lt;p>After a failover or failback it is necessary to verify that traffic is flowing appropriately.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Login to the portal and navigate to the affected &lt;a href="https://docs.trustgrid.io/docs/clusters/">cluster’s&lt;/a> page&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Verify that only a single &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> shows as master&lt;/p>
&lt;/li>
&lt;li>
&lt;p>On the &lt;code>Configuration&lt;/code> → &lt;code>Network&lt;/code> tab note the &lt;a href="https://docs.trustgrid.io/docs/clusters/">cluster&lt;/a> VIP&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="cluster-virtual-ip2.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Click on the indicated current master&lt;/p>
&lt;p>a. Verify the VPN Route Table shows&lt;/p>
&lt;pre>&lt;code>i. Navigate to the `Configuration` → `VPN` tab
ii. Launch the &amp;quot;View Virtual Route Table&amp;quot; tool
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="virtual-network-tools.png" alt="img">&lt;/p>
&lt;pre>&lt;code>iii. Verify that routes show as “available true”
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="routing-tables.png" alt="img">&lt;/p>
&lt;pre>&lt;code> 1. If the cluster is a gateway cluster there may be many routes and not all be active, just confirm many show as available.
2. The route to the management VIP for the other node in the cluster will always be false.
&lt;/code>&lt;/pre>
&lt;p>b. Verify traffic is flowing through the appropriate node.&lt;/p>
&lt;pre>&lt;code>i. Navigate to the `Configuration` → `Network` tab
ii. Confirm the interface associated with the Cluster VIP is selected
3. For single interface nodes: ETH0 / Network Adapter 1 - WAN Adapter
4. For dual interface nodes: ETH1 / Network Adapter 2 - LAN Adapter
iii. Open the `Sniff Interface Traffic` tool.
5. Set the filter to “host clusterVIP” without quotes and replacing clusterVIP with the appropriate Cluster virtual IP. Click `start session`.
6. Confirm that you see traffic flowing through the interface. **Continue monitoring for several minutes to confirm the traffic is maintained.**
7. Leave the Sniff Interface Tool running while completing the next step
iv. Repeat steps i-iii on the node that **is not** currently indicated as the master.
1.You want to verify there is **no traffic for the cluster VIP running through the non-master node**.
8. You may see a periodic ARP from the cluster master, but that should be it.
&lt;/code>&lt;/pre>
&lt;ol>
&lt;li>
&lt;p>Compare traffic volume before and after the failover&lt;/p>
&lt;p>a. If the event was a failover and failback compare traffic from the current master&lt;/p>
&lt;p>b. If the event was a failover but has not failed back you will need to compare traffic volume on the current master to the volume on the previous master&lt;/p>
&lt;pre>&lt;code> i. e.g if traffic failed from node1 to node2, compare node1’s traffic prior to the failover to the volume of traffic on node2 after the failover
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol></description></item><item><title>Tutorials: Control Plane Disconnect</title><link>https://docs.trustgrid.io/tutorials/operations-runbook/control-plane-disconnect/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/operations-runbook/control-plane-disconnect/</guid><description>
&lt;blockquote>
&lt;p>When the Control Plane is disconnected there is no way to utilize remote tools to resolve the issue so you will need to contact the End-user technical resource for the site to troubleshoot&lt;/p>
&lt;/blockquote>
&lt;p>When troubleshooting the control plane it is a good idea to familiarize yourself with the &lt;a href="https://docs.trustgrid.io/help-center/kb/startup-process/">Edge Node Startup Process&lt;/a>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th> Network Requirements &lt;/th>
&lt;/tr>
&lt;tr>
&lt;td>
In order to connect to the Trustgrid Control Plane, the following &lt;strong>outbound traffic&lt;/strong> must be allowed from the node’s configured primary interface IP address &lt;br/>
&lt;ul>
&lt;li>TCP Port 443 and TCP/UDP 8443 to:&lt;/li>
&lt;ul>
&lt;li>35.171.100.16/28&lt;/li>
&lt;li>34.223.12.192/28&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>TCP/UDP Port 53 to the configured DNS servers. These DNS servers must be able to resolve DNS requests for the trustgrid.io domain&lt;/li>
&lt;/ul>
&lt;/table>
&lt;h2 id="troubleshoot-from-the-node">Troubleshoot from the Node&lt;/h2>
&lt;ol>
&lt;li>Triage the total site connectivity to see if actions can be taken to restore functionality for the edge site while troubleshooting the specific node&lt;/li>
&lt;li>Confirm with the site tech:
&lt;ol>
&lt;li>There are no known power or internet issues at the site&lt;/li>
&lt;li>No changes have been made to any firewalls between the Trustgrid node and the internet (if applicable). To connect the Trustgrid node must have access to the Network Requirements defined above.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Have the site tech attempt to ping the inside interface IP address(es) to see if the device is showing as powered up and online. If the site is using a single-interface configuration this would be the Network Adapter 1 - WAN Interface IP(s) in the portal.
&lt;ol>
&lt;li>If the ping is successful you have determined the device has power and that the operating system and Trustgrid software are running. In this case, you can focus on internet side issues.&lt;/li>
&lt;li>If the ping fails, work with the site tech to:
&lt;ol>
&lt;li>Confirm the node is powered on&lt;/li>
&lt;li>Connect directly to the network of the inside interface and attempt ping from there. They should also connect directly to the inside interface and statically configure an IP in the same network.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Attempt power cycling the node by removing power and reconnecting for physical devices, or using the hypervisor management tools for virtual nodes.&lt;/li>
&lt;li>Connect to the console of the device
&lt;ol>
&lt;li>A normal node looks something like this:
&lt;script src="https://docs.trustgrid.io/js/fullscreen.js">&lt;/script>
&lt;figure class="centered-image">
&lt;img src="normal-node.png" alt="" onclick="toggleImageSize(this)" style="display: block; margin-left: auto; margin-right: auto; width: 80%;">
&lt;figcaption style="text-align: center; margin-top: 0.5rem; font-weight: lighter;">
Normal node login screen
&lt;/figcaption>
&lt;/figure>
Work with the onsite tech to log in to the &lt;a href="https://docs.trustgrid.io/tutorials/local-console-utility/#accessing-the-trustgrid-console-utility">Trustgrid Local Console Utility&lt;/a>. This tool will display the connectivity status and allow you to alter the WAN/outside IP settings if needed. From the console, you can also use the &lt;a href="https://docs.trustgrid.io/tutorials/local-console-utility/troubleshooting/#network-tools-shell">Network Tools Shell&lt;/a> to do additional troubleshooting including:
&lt;ol>
&lt;li>Use &lt;code>ping&lt;/code> to confirm you can ping the WAN interface&amp;rsquo;s default gateway IP. Note that not all default gateways will respond to ping but most do.&lt;/li>
&lt;li>Use &lt;code>dig @&amp;lt;dns server IP&amp;gt; zuul.trustgrid.io +short&lt;/code> to confirm the DNS server is resolving to an IP address. Replace &lt;code>&amp;lt;dns server IP&amp;gt;&lt;/code> with the DNS server configured on the WAN interfaces. If this does not work, work with the site tech to confirm the DNS server is configured correctly.&lt;/li>
&lt;li>Use &lt;code>openssl&lt;/code> to confirm the &lt;a href="https://docs.trustgrid.io/help-center/kb/startup-process/ssl-tls-tampering/#verification">TLS certificate chain to the Trustgrid Control Plane is valid&lt;/a>.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>If you see a screen like below attempt rebooting the device to restore connectivity and contact Trustgrid support so we can investigate further.
&lt;script src="https://docs.trustgrid.io/js/fullscreen.js">&lt;/script>
&lt;figure class="centered-image">
&lt;img src="node-panic.png" alt="" onclick="toggleImageSize(this)" style="display: block; margin-left: auto; margin-right: auto; width: 80%;">
&lt;figcaption style="text-align: center; margin-top: 0.5rem; font-weight: lighter;">
Kernel panic screen
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="troubleshoot-from-an-independent-device-in-place-of-node">Troubleshoot from an Independent Device in place of Node&lt;/h2>
&lt;p>If connectivity cannot be established from the node, you can attempt to connect from an independent device like a laptop plugged into the port the node was plugged into.&lt;/p>
&lt;ol>
&lt;li>Disconnect the cable from the WAN/Outside port of the Trustgrid node and connect to a laptop NIC. Statically assign the same &lt;strong>IP and DNS settings&lt;/strong> that the Trustgrid node is using.&lt;/li>
&lt;li>Confirm DNS is functioning:
&lt;ol>
&lt;li>Using &lt;code>nslookup&lt;/code> (on Windows) or &lt;code>dig&lt;/code> (Linux or MacOS) to confirm you can resolve zuul.trustgrid.io&lt;/li>
&lt;li>Open a browser and navigate to &lt;a href="https://zuul.trustgrid.io:8443">https://zuul.trustgrid.io:8443&lt;/a>
&lt;ol>
&lt;li>If the device can connect to that server and port you should see a warning like this because Trustgrid uses its own Certificate Authority (CA)
&lt;script src="https://docs.trustgrid.io/js/fullscreen.js">&lt;/script>
&lt;figure class="centered-image">
&lt;img src="link.png" alt="" onclick="toggleImageSize(this)" style="display: block; margin-left: auto; margin-right: auto; width: 50%;">
&lt;figcaption style="text-align: center; margin-top: 0.5rem; font-weight: lighter;">
Certificate security warning
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>Click &lt;code>Not Secure&lt;/code> and then click &lt;code>Certificate (invalid)&lt;/code> to view the certificate chain.
&lt;script src="https://docs.trustgrid.io/js/fullscreen.js">&lt;/script>
&lt;figure class="centered-image">
&lt;img src="certificate-invalid.png" alt="" onclick="toggleImageSize(this)" style="display: block; margin-left: auto; margin-right: auto; width: 50%;">
&lt;figcaption style="text-align: center; margin-top: 0.5rem; font-weight: lighter;">
Expanded certificate security warning
&lt;/figcaption>
&lt;/figure>
&lt;/li>
&lt;li>You should expect to see a chain like the below example:
&lt;script src="https://docs.trustgrid.io/js/fullscreen.js">&lt;/script>
&lt;figure class="centered-image">
&lt;img src="chain.png" alt="" onclick="toggleImageSize(this)" style="display: block; margin-left: auto; margin-right: auto; width: 70%;">
&lt;/figure>
If any different certificates or CAs indicate something like DPI-SSL/HTTPS Proxy is &lt;a href="https://docs.trustgrid.io/help-center/kb/startup-process/ssl-tls-tampering/#resolution">interfering with the TLS Certificate Chain&lt;/a>.&lt;/li>
&lt;li>If the browser says it cannot connect this indicates a firewall or routing issue upstream.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;h2 id="troubleshoot-from-an-upstream-network-device">Troubleshoot from an Upstream Network Device&lt;/h2>
&lt;p>If the site contact has management access to the device between the node and the internet, like a firewall or router, you can attempt to capture relevant traffic to determine where the issue lies. Specifically, look for the following common issues:&lt;/p>
&lt;div class="alert alert-warning" role="alert">
When capturing traffic it is recommended to perform the capture on the interfaces &lt;strong>closest to the Trustgrid node&lt;/strong>. This ensures you see the complete impact of firewall, routing, and NAT rules.&lt;br>
For example, if your firewall has a WAN interface connected to the internet and a LAN interface connected to the network the node is attached to, use the LAN interface for captures. Capturing from the WAN interface would give an incomplete picture. A WAN interface may receive a SYN/ACK response, but due to the firewall configuration that packet may not be put on the LAN network as expected.
&lt;/div>
&lt;ol>
&lt;li>Blocked DNS Access - capture TCP &amp;amp; UDP on port 53 (DNS) to confirm DNS requests are being sent to the upstream DNS server and responses are being delivered to the node.&lt;/li>
&lt;li>Confirm Control Plane Traffic - capture TCP port 8443 to the &lt;a href="https://docs.trustgrid.io/help-center/kb/site-requirements/#trustgrid-control-plane">Trustgrid Control Plane&lt;/a> networks. Common issues seen include:
&lt;ul>
&lt;li>Connection attempts are being blocked (access rules) or responses are not being put back on the network containing then node (routing or NAT rules)&lt;/li>
&lt;li>DPI-SSL or HTTPS &lt;a href="https://docs.trustgrid.io/help-center/kb/startup-process/ssl-tls-tampering/#symptoms">altering the TLS certificate chain&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Tutorials: Node Down Response</title><link>https://docs.trustgrid.io/tutorials/operations-runbook/node-down-response/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/operations-runbook/node-down-response/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>This process is intended to help customer support personnel quickly identify the scope of a &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> down problem and get services back online as quickly as possible.&lt;/p>
&lt;/div>
&lt;h3 id="node-down-triage">Node Down Triage&lt;/h3>
&lt;h4 id="triage-checklist">Triage Checklist&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>Determine Production Status of the Trustgrid Node&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Confirm High Availability or Disaster Recover is Functioning&lt;/p>
&lt;ul>
&lt;li>
&lt;p>If clustered, is the partner active and working&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If there is a second site, confirm if it is active&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>Determine the type of outage (Control Plane, Data Plane or Both)&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="determine-production-status-of-the-trustgrid-node">Determine Production Status of the Trustgrid Node&lt;/h3>
&lt;p>Use the &lt;a href="https://docs.trustgrid.io/docs/nodes/shared/tags/prod-status-tag/%7D">Production Status Tags&lt;/a> to determine if the &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> is in use and expected to be online.&lt;/p>
&lt;h3 id="confirm-high-availability-or-disaster-recover-is-functioning">Confirm High Availability or Disaster Recover is Functioning&lt;/h3>
&lt;p>Before troubleshooting why a &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> is down we should determine if the services it provided can be provided in the interim by a cluster member or devices at a secondary/disaster-recovery site.&lt;/p>
&lt;h5 id="is-the-node-a-cluster-member">Is the Node a Cluster Member&lt;/h5>
&lt;ul>
&lt;li>
&lt;p>Check if partner member is online:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>If Yes:&lt;/p>
&lt;pre>&lt;code>- Confirm partner member is now active and operating normally.
- The issue is limited to this specific Node. This could be its power input, the hardware or operating system, configuration, or its internet connection (if different than partner member).
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>If No:&lt;/p>
&lt;pre>&lt;code>- Possible site-level issue including power or internet provider
- Proceed to Secondary / DR Site
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h5 id="is-there-a-secondary--dr-site-for-this-nodecluster">Is there a Secondary / DR Site for this Node/Cluster?&lt;/h5>
&lt;ul>
&lt;li>
&lt;p>Are the &lt;a href="https://docs.trustgrid.io/docs/nodes/">nodes&lt;/a> deployed at the secondary site online in the Trustgrid?&lt;/p>
&lt;ul>
&lt;li>
&lt;p>If No:&lt;/p>
&lt;pre>&lt;code>- Confirm nodes for other end-user sites are not also offline which might indicate a wider spread issue. Escalate to Trustgrid Support if you suspect a major issue with the Trustgrid system.
- If limited to a single customer it is recommended to contact that customer immediately. They may be experiencing an outage or performing maintenance.
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>If Yes:&lt;/p>
&lt;pre>&lt;code>- If the customer is configured for Automatic Failover between sites, verify that traffic is flowing through the active member at the secondary site.
- If the customer is configured for Manual Failover you will need to adjust the route destination to point to the secondary site.
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="determine-connectivity-status-of-the-trustgrid-node">Determine Connectivity Status of the Trustgrid Node&lt;/h3>
&lt;p>Because Trustgrid provides independent control and data planes, there are a few ways it can manifest as “down”:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Field Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr id="control-plane-down" style="scroll-margin-top: 10rem;">
&lt;th>Control Plane Down&lt;/th>
&lt;td>The &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> appears offline from within the Trustgrid portal. This indicates that the &lt;a href="https://docs.trustgrid.io/tutorials/operations-runbook/control-plane-disconnect/">node is disconnected&lt;/a> from the control plane either because it has shutdown or has been unable to send a heartbeat notification to Trustgrid within the past 10 minutes.&lt;/td>
&lt;/tr>
&lt;tr id="data-plane-down" style="scroll-margin-top: 10rem;">
&lt;th>Data Plane Down&lt;/th>
&lt;td>The &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> appears online from within the portal but reports it is unable to connect to one or more gateway nodes. This can be indicated by the Data Plane Status indicator when viewing the &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> in the portal, or by receiving a “Gateway Connectivity Health Check” failure &lt;a href="https://docs.trustgrid.io/docs/alarms/events/">event&lt;/a> notification. Both of these only work if the Control Plane is currently working.&lt;/td>
&lt;/tr>
&lt;tr id="both-control-and-data-plane-down" style="scroll-margin-top: 10rem;">
&lt;th>Both Control and Data Plane Down&lt;/th>
&lt;td>In this situation the &lt;a href="https://docs.trustgrid.io/docs/nodes/">node&lt;/a> appears down in the Trustgrid Portal and users/applications are unable to reach services across the data plane between the Gateway and Edge sites. This is the most common scenario. While the Data Plane is most critical for the services provided across the device, first priority should be restoring the Control Plane connection so that additional troubleshooting tools are available. Often this process also uncovers the reason the data plane is down.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Tutorials: Site Failover</title><link>https://docs.trustgrid.io/tutorials/operations-runbook/site-failover/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/operations-runbook/site-failover/</guid><description>
&lt;div class="pageinfo pageinfo-primary">
&lt;p>The below processes should be used to move traffic between sites in event of a complete site down scenario. This is handled by the Virtual Network Route Table.&lt;/p>
&lt;/div>
&lt;div class="alert alert-primary" role="alert">
In the examples below, xxxEdgeCluster is the primary site and xxx-edge3 is the secondary/disaster recovery site.
&lt;/div>
&lt;h3 id="manual-failover">Manual Failover&lt;/h3>
&lt;p>When a customer has selected manual failover, a portal user will need to adjust the destination of all &lt;a href="https://docs.trustgrid.io/docs/domain/virtual-networks/routes/">routes&lt;/a> currently pointed at the failed site.&lt;/p>
&lt;h4 id="failing-over">Failing Over&lt;/h4>
&lt;blockquote>
&lt;p>There will usually be &lt;a href="https://docs.trustgrid.io/docs/domain/virtual-networks/routes/">routes&lt;/a> for the &lt;a href="https://docs.trustgrid.io/docs/nodes/">nodes&amp;rsquo;&lt;/a> Virtual Management IP. These should not be changed in this process.&lt;/p>
&lt;/blockquote>
&lt;ol>
&lt;li>
&lt;p>In the portal, navigate to &lt;code>Domain&lt;/code> → &lt;code>Virtual Networks&lt;/code> and then select the appropriate Virtual network.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select the &lt;code>Routes&lt;/code> panel from the left navigation bar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Filter the route table either using the node/cluster names or network to be failed over (shown below).&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="route-table.png" alt="img">&lt;/p>
&lt;pre>&lt;code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
&lt;/code>&lt;/pre>
&lt;ol>
&lt;li>Clear the destination field and start typing the name of the secondary site node/cluster. Select the appropriate node/cluster from the list.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="destination-field.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Click &lt;code>Save&lt;/code>. Then select &lt;code>Review Changes&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>You should see a modified &lt;a href="https://docs.trustgrid.io/docs/domain/virtual-networks/routes/">route&lt;/a> for each network you adjusted showing the previous and current destination. If everything looks correct click &lt;code>Apply Changes&lt;/code>.&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="apply-changes.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>It may take 1-2 minutes for nodes to pull down the updated routing table. Once that has completed any new flow or connection will automatically be sent to the new destination node.&lt;/li>
&lt;/ol>
&lt;div class="alert alert-primary" role="alert">
If the node/cluster is still online at the primary site, and there are existing flows/connections they will persist at that site. To clear them restart the active node at the primary site. See the last step in the Forcing Failover section below for instructions.
&lt;/div>
&lt;h4 id="failing-back">Failing Back&lt;/h4>
&lt;p>To send traffic back to the primary site reverse the changes in the routing performed during the failover.&lt;/p>
&lt;h3 id="automatic-failover">Automatic Failover&lt;/h3>
&lt;p>When a customer has selected automatic failover between sites there should be no intervention required if the primary site goes offline. The route table will be configured with multiple routes with different metrics. When determining where to send virtual traffic a node will select:&lt;/p>
&lt;ul>
&lt;li>The most specific route - meaning if there is a route for 192.168.100.1/32 and another for 192.168.100.0/24, the /32 route will be preferred&lt;/li>
&lt;li>With the lowest metric&lt;/li>
&lt;li>that is currently available - meaning this node has an active tunnel to the destination node/cluster&lt;/li>
&lt;/ul>
&lt;p>Below reflects a typical automatic failover configuration for a network&lt;/p>
&lt;h4 id="forcing-failover-or-prevent-auto-failback">Forcing Failover or Prevent Auto-Failback&lt;/h4>
&lt;p>If it is necessary to move traffic to the secondary site without the primary site going offline follow the below process.&lt;/p>
&lt;p>Also, if a failure of the primary site has occurred and you want to ensure traffic does not automatically return to that site if it comes online (e.g. it is unstable) you can follow the same process.&lt;/p>
&lt;ol>
&lt;li>
&lt;p>In the portal, navigate to &lt;code>Domain&lt;/code> → &lt;code>Virtual Networks&lt;/code> and then select the appropriate Virtual network.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Select &lt;code>Routes&lt;/code> from the left navigation bar.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Filter the route table either using the node/cluster names or network to be failed over (shown below)&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="route-table.png" alt="img">&lt;/p>
&lt;pre>&lt;code>a. If there is more than one network that needs to be routed to the secondary site using node/cluster names to filter is more efficient
&lt;/code>&lt;/pre>
&lt;ol>
&lt;li>Adjust the metric so that the primary site is a higher number than the secondary site. The maximum metric value is 200.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="metric.png" alt="img">&lt;/p>
&lt;p>Click &lt;code>Save&lt;/code> and navigate to &lt;code>Review Changes&lt;/code>&lt;/p>
&lt;p>You should see a change like below for each route adjusted. Click &lt;code>Apply Changes&lt;/code> if all looks correct.&lt;/p>
&lt;p>&lt;img src="apply-changes-metric.png" alt="img">&lt;/p>
&lt;ol>
&lt;li>
&lt;p>It may take 1-2 minutes for nodes to pull down the updated route table. At that point, they will route new flows/connections to the new destination.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Because the primary site is still online, you will need to restart the active node at that site to clear out any existing flows/connections.&lt;/p>
&lt;p>a. If it&amp;rsquo;s a cluster, navigate to the cluster and then select the currently active node from the overview page. If a single node site, navigate directly to that node.&lt;/p>
&lt;p>b. From the toolbar select &lt;code>Restart&lt;/code>&lt;/p>
&lt;p>c. Enter the node’s name and click &lt;code>confirm&lt;/code>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="restore-traffic-to-primary-site">Restore Traffic to Primary Site&lt;/h3>
&lt;p>To restore traffic to the primary site repeat the above steps but set the route for the primary site to have the lowest metric.&lt;/p></description></item></channel></rss>