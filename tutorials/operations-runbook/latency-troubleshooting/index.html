<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Troubleshoot High Tunnel Latency | </title><meta name=description content="Active Incident Triage Steps These steps should be performed as soon as possible while the incident is occurring.
Latency issues are frequently temporary and if you do not gather this information at the time of the incident it will prevent deeper analysis. 1. Enable Hop Monitoring Requires permissions to modify the edge node config. If your user is read-only skip to Step 2.
Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it&rsquo;s attached gateways."><meta property="og:url" content="https://docs.trustgrid.io/tutorials/operations-runbook/latency-troubleshooting/"><meta property="og:title" content="Troubleshoot High Tunnel Latency"><meta property="og:description" content="Active Incident Triage Steps These steps should be performed as soon as possible while the incident is occurring.
Latency issues are frequently temporary and if you do not gather this information at the time of the incident it will prevent deeper analysis. 1. Enable Hop Monitoring Requires permissions to modify the edge node config. If your user is read-only skip to Step 2.
Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it’s attached gateways."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="tutorials"><meta property="article:published_time" content="2024-10-21T00:00:00+00:00"><meta property="article:modified_time" content="2024-10-21T00:00:00+00:00"><meta itemprop=name content="Troubleshoot High Tunnel Latency"><meta itemprop=description content="Active Incident Triage Steps These steps should be performed as soon as possible while the incident is occurring.
Latency issues are frequently temporary and if you do not gather this information at the time of the incident it will prevent deeper analysis. 1. Enable Hop Monitoring Requires permissions to modify the edge node config. If your user is read-only skip to Step 2.
Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it’s attached gateways."><meta itemprop=datePublished content="2024-10-21T00:00:00+00:00"><meta itemprop=dateModified content="2024-10-21T00:00:00+00:00"><meta itemprop=wordCount content="2971"><meta name=twitter:card content="summary"><meta name=twitter:title content="Troubleshoot High Tunnel Latency"><meta name=twitter:description content="Active Incident Triage Steps These steps should be performed as soon as possible while the incident is occurring.
Latency issues are frequently temporary and if you do not gather this information at the time of the incident it will prevent deeper analysis. 1. Enable Hop Monitoring Requires permissions to modify the edge node config. If your user is read-only skip to Step 2.
Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it’s attached gateways."><link rel=preload href=/scss/main.min.75db9a0ad6be50f4b3f53af969fcacc7b87f08291f6833aa5739c3339d9a08f3.css as=style><link href=/scss/main.min.75db9a0ad6be50f4b3f53af969fcacc7b87f08291f6833aa5739c3339d9a08f3.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/getting-started/><span>Getting Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/tutorials/><span>Guides</span></a></li><li class=nav-item><a class=nav-link href=/help-center/><span>Help Center</span></a></li><li class=nav-item><a class=nav-link href=/release-notes/><span>Release Notes</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9dbd22f5693fd8e090ffd06d458d069f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9dbd22f5693fd8e090ffd06d458d069f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><a href=/tutorials/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-tutorials><span>Guides</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsdeployments-li><a href=/tutorials/deployments/ title="Node Appliance Deployments" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeployments><span>Appliance Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsaws-ha-cluster-li><a href=/tutorials/deployments/aws-ha-cluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-cluster><span>AWS Requirements for HA Wireguard Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster-li><a href=/tutorials/deployments/aws-ha-ztna-gateway-cluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster><span>AWS Requirements for HA ZTNA Gateway Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws-li><a href=/tutorials/deployments/configure-ha-gateway-cluster-in-aws/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws><span>Configure HA Trustgrid Gateway Cluster in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-aws-ami-li><a href=/tutorials/deployments/deploy-aws-ami/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-aws-ami><span>Deploy a Trustgrid Node AMI in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-tutorialsdeploymentsdeploy-azure-li><a href=/tutorials/deployments/deploy-azure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeploymentsdeploy-azure><span>Deploy to Azure</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deployment-li><a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/ title="Azure CLI (az) Deployment" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deployment><span>AZ CLI Deployment</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deploymentaz-cli-example-li><a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/ title="Example Walkthrough  of Azure CLI (az) Deployment" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deploymentaz-cli-example><span>AZ CLI Example Walkthrough</span></a></li></ul></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsdeploy-vsphere-li><a href=/tutorials/deployments/deploy-vsphere/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-vsphere><span>Deploy to vSphere</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsdeploymentsros-config-li><a href=/tutorials/deployments/ros-config/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsros-config><span>On a Stick Configuration</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsagent-deploy-li><a href=/tutorials/agent-deploy/ title="Node Agent Deployments" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsagent-deploy><span>Agent Deployments</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsmanagement-tasks-li><a href=/tutorials/management-tasks/ title="Management Operations" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsmanagement-tasks><span>Management Ops</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-tutorialsmanagement-tasksagent-mgmt-li><a href=/tutorials/management-tasks/agent-mgmt/ title="Agent Node Management" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsmanagement-tasksagent-mgmt><span>Agent Management</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksagent-mgmtrestart-agent-li><a href=/tutorials/management-tasks/agent-mgmt/restart-agent/ title="Restart Agent Node Service" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksagent-mgmtrestart-agent><span>Restart Agent</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksagent-mgmtupgrade-agent-li><a href=/tutorials/management-tasks/agent-mgmt/upgrade-agent/ title="Upgrade Trustgrid Agent Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksagent-mgmtupgrade-agent><span>Upgrade Agent Nodes</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-taskschanging-node-status-li><a href=/tutorials/management-tasks/changing-node-status/ title="Changing Node Status (Enabling / Disabling)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-taskschanging-node-status><span>Changing Node Status</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksrestart-node-li><a href=/tutorials/management-tasks/restart-node/ title="Restart the Trustgrid Service on a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksrestart-node><span>Restart Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksreboot-node-li><a href=/tutorials/management-tasks/reboot-node/ title="Reboot a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksreboot-node><span>Reboot Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksupdate-node-config-li><a href=/tutorials/management-tasks/update-node-config/ title="Force Node to Pull Down Configuration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksupdate-node-config><span>Update Node Config</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksupgrade-nodes-li><a href=/tutorials/management-tasks/upgrade-nodes/ title="Upgrading Trustgrid Appliance Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksupgrade-nodes><span>Upgrade Appliance Nodes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksdeleting-nodes-li><a href=/tutorials/management-tasks/deleting-nodes/ title="Deleting Trustgrid Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksdeleting-nodes><span>Deleting Nodes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksdeleting-clusters-li><a href=/tutorials/management-tasks/deleting-clusters/ title="Deleting Trustgrid Clusters" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksdeleting-clusters><span>Deleting Clusters</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsoperations-runbook-li><a href=/tutorials/operations-runbook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsoperations-runbook><span>Operations Runbook</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-tutorialsoperations-runbooklatency-troubleshooting-li><a href=/tutorials/operations-runbook/latency-troubleshooting/ title="Troubleshoot High Tunnel Latency" class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooklatency-troubleshooting><span class=td-sidebar-nav-active-item>Latency Troubleshooting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsoperations-runbookcluster-failover-response-li><a href=/tutorials/operations-runbook/cluster-failover-response/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcluster-failover-response><span>Cluster Failover Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsoperations-runbookcontrol-plane-disconnect-li><a href=/tutorials/operations-runbook/control-plane-disconnect/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcontrol-plane-disconnect><span>Control Plane Disconnect</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsoperations-runbooknode-down-response-li><a href=/tutorials/operations-runbook/node-down-response/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooknode-down-response><span>Node Down Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsoperations-runbooksite-failover-li><a href=/tutorials/operations-runbook/site-failover/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooksite-failover><span>Site Failover</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsinterface-tools-li><a href=/tutorials/interface-tools/ title="Network Interface Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsinterface-tools><span>Interface Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolssniff-interface-traffic-li><a href=/tutorials/interface-tools/sniff-interface-traffic/ title="Sniff Traffic Interface Tool" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolssniff-interface-traffic><span>Sniff Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolstcp-port-test-li><a href=/tutorials/interface-tools/tcp-port-test/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolstcp-port-test><span>TCP Port Test</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolstraffic-capture-li><a href=/tutorials/interface-tools/traffic-capture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolstraffic-capture><span>Traffic Capture</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsremote-tools-li><a href=/tutorials/remote-tools/ title="Remote VPN Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsremote-tools><span>VPN Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsping-remote-virtual-host-li><a href=/tutorials/remote-tools/ping-remote-virtual-host/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsping-remote-virtual-host><span>Ping Remote Virtual Host</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolssniff-virtual-traffic-li><a href=/tutorials/remote-tools/sniff-virtual-traffic/ title="Sniff Virtual Traffic" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolssniff-virtual-traffic><span>Sniff VPN Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsview-virtual-route-table-li><a href=/tutorials/remote-tools/view-virtual-route-table/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsview-virtual-route-table><span>View Virtual Route Table</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsgateway-tools-li><a href=/tutorials/gateway-tools/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsgateway-tools><span>Gateway Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers-li><a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers><span>Monitoring Network Hops to Peers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsping-remote-node-li><a href=/tutorials/gateway-tools/ping-remote-node/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsping-remote-node><span>Ping Remote Node</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialswan-interface-ip-li><a href=/tutorials/wan-interface-ip/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialswan-interface-ip><span>Changing the WAN Interface IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsftp-and-ftps-li><a href=/tutorials/ftp-and-ftps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsftp-and-ftps><span>Configure FTP and FTPS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfig-l3-vpn-li><a href=/tutorials/config-l3-vpn/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfig-l3-vpn><span>Configure Layer 3 VPN</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfigure-wg-edge-node-li><a href=/tutorials/configure-wg-edge-node/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfigure-wg-edge-node><span>Configure WireGuard on an Edge Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialscontainers-li><a href=/tutorials/containers/ title="Container Deployment Walkthrough" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialscontainers><span>Container Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialscontainersthousand-eyes-li><a href=/tutorials/containers/thousand-eyes/ title="Deploying ThousandEyes Enterprise Agent Container on Trustgrid" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialscontainersthousand-eyes><span>ThousandEyes Agent Container</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssaml-okta-li><a href=/tutorials/saml-okta/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssaml-okta><span>Enable SAML with Okta</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfind-ip-node-li><a href=/tutorials/find-ip-node/ title="Find the Public IP Address of a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfind-ip-node><span>Finding Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslimit-node-functionality-li><a href=/tutorials/limit-node-functionality/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslimit-node-functionality><span>Limit Node Functionality to Current Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialslocal-console-utility-li><a href=/tutorials/local-console-utility/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialslocal-console-utility><span>Trustgrid Local Console Utility</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilityadvanced-network-config-li><a href=/tutorials/local-console-utility/advanced-network-config/ title="Advanced Network Configuration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilityadvanced-network-config><span>Advanced Network Config</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilityremote-registration-li><a href=/tutorials/local-console-utility/remote-registration/ title="Remote Console Registration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilityremote-registration><span>Remote Registration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilitytroubleshooting-li><a href=/tutorials/local-console-utility/troubleshooting/ title="Troubleshooting Menu" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilitytroubleshooting><span>Troubleshooting</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/trustgrid/docs/tree/main/content/en/tutorials/operations-runbook/latency-troubleshooting/index.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/trustgrid/docs/edit/main/content/en/tutorials/operations-runbook/latency-troubleshooting/index.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/trustgrid/docs/new/main/content/en/tutorials/operations-runbook/latency-troubleshooting?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/trustgrid/docs/issues/new?title=Troubleshoot%20High%20Tunnel%20Latency" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#active-incident-triage-steps>Active Incident Triage Steps</a><ul><li><a href=#1-enable-hop-monitoring>1. Enable Hop Monitoring</a></li><li><a href=#2-run-mtr-to-reported-gateway>2. Run MTR To Reported Gateway</a></li><li><a href=#3-check-latency-to-other-gateways>3. Check Latency to Other Gateways</a></li><li><a href=#4-clustered-edge-nodes-only-check-latency-from-cluster-peer>4. (Clustered Edge Nodes Only) Check Latency from Cluster Peer</a></li><li><a href=#5-run-data-plane-performance-test>5. Run Data Plane Performance Test</a></li></ul></li><li><a href=#post-incident-triage-steps>Post Incident Triage Steps</a><ul><li><a href=#1-enable-hop-monitoring-1>1. Enable Hop Monitoring</a></li><li><a href=#2-use-data-plane-panel-to-view-latency-to-gateways>2. Use Data Plane Panel to View Latency to Gateways</a></li></ul></li><li><a href=#latency-issue-matrix>Latency Issue Matrix</a></li><li><a href=#advanced-troubleshooting-steps>Advanced Troubleshooting Steps</a><ul><li><a href=#determine-path-mtu-with-ping>Determine Path MTU with Ping</a></li></ul></li><li><a href=#faq>FAQ</a><ul><li><a href=#what-is-high-tunnel-latency-and-what-are-common-causes>What is High Tunnel Latency and what are common causes?</a></li><li><a href=#latency-tcp-vs-udp-tunnels>Latency TCP vs UDP Tunnels</a></li><li><a href=#why-does-the-tunnel-show-latency-but-hop-monitor-data-doesnt>Why does the tunnel show latency but hop monitor data doesn&rsquo;t?</a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/concepts/ data-taxonomy-term=concepts><span class=taxonomy-label>Concepts</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/data-store/ data-taxonomy-term=data-store><span class=taxonomy-label>Data Store</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/idps/ data-taxonomy-term=idps><span class=taxonomy-label>Idps</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/node/ data-taxonomy-term=node><span class=taxonomy-label>Node</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/overview/ data-taxonomy-term=overview><span class=taxonomy-label>Overview</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/virtual-machines/ data-taxonomy-term=virtual-machines><span class=taxonomy-label>Virtual Machines</span><span class=taxonomy-count>3</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alarm-filters/ data-taxonomy-term=alarm-filters><span class=taxonomy-label>Alarm Filters</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alarms/ data-taxonomy-term=alarms><span class=taxonomy-label>Alarms</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alert-suppression/ data-taxonomy-term=alert-suppression><span class=taxonomy-label>Alert Suppression</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/applications/ data-taxonomy-term=applications><span class=taxonomy-label>Applications</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/architecture/ data-taxonomy-term=architecture><span class=taxonomy-label>Architecture</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/channels/ data-taxonomy-term=channels><span class=taxonomy-label>Channels</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster/ data-taxonomy-term=cluster><span class=taxonomy-label>Cluster</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster-health/ data-taxonomy-term=cluster-health><span class=taxonomy-label>Cluster Health</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster-management/ data-taxonomy-term=cluster-management><span class=taxonomy-label>Cluster Management</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/clusters/ data-taxonomy-term=clusters><span class=taxonomy-label>Clusters</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/concepts/ data-taxonomy-term=concepts><span class=taxonomy-label>Concepts</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/control-plane-disconnect/ data-taxonomy-term=control-plane-disconnect><span class=taxonomy-label>Control Plane Disconnect</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/data-store/ data-taxonomy-term=data-store><span class=taxonomy-label>Data Store</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/domain/ data-taxonomy-term=domain><span class=taxonomy-label>Domain</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/event-types/ data-taxonomy-term=event-types><span class=taxonomy-label>Event Types</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/events/ data-taxonomy-term=events><span class=taxonomy-label>Events</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/failover/ data-taxonomy-term=failover><span class=taxonomy-label>Failover</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/help/ data-taxonomy-term=help><span class=taxonomy-label>Help</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/layer-4/ data-taxonomy-term=layer-4><span class=taxonomy-label>Layer 4</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/node/ data-taxonomy-term=node><span class=taxonomy-label>Node</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/overview/ data-taxonomy-term=overview><span class=taxonomy-label>Overview</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/rewrite/ data-taxonomy-term=rewrite><span class=taxonomy-label>Rewrite</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/s3/ data-taxonomy-term=s3><span class=taxonomy-label>S3</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/tag/ data-taxonomy-term=tag><span class=taxonomy-label>Tag</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/troubleshoot/ data-taxonomy-term=troubleshoot><span class=taxonomy-label>Troubleshoot</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/tunnels/ data-taxonomy-term=tunnels><span class=taxonomy-label>Tunnels</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/upgrade-manager/ data-taxonomy-term=upgrade-manager><span class=taxonomy-label>Upgrade Manager</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/virtual-machines/ data-taxonomy-term=virtual-machines><span class=taxonomy-label>Virtual Machines</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/vrfs/ data-taxonomy-term=vrfs><span class=taxonomy-label>VRFs</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/wireguard/ data-taxonomy-term=wireguard><span class=taxonomy-label>Wireguard</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/ztna/ data-taxonomy-term=ztna><span class=taxonomy-label>Ztna</span><span class=taxonomy-count>8</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/tutorials/>Guides</a></li><li class=breadcrumb-item><a href=/tutorials/operations-runbook/>Operations Runbook</a></li><li class="breadcrumb-item active" aria-current=page>Latency Troubleshooting</li></ol></nav><div class=td-content><h1>Troubleshoot High Tunnel Latency</h1><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 14 minute read &nbsp;</p></header><h2 id=active-incident-triage-steps>Active Incident Triage Steps</h2><p>These steps should be performed as soon as possible <strong>while</strong> the incident is occurring.</p><div class="alert alert-warning" role=alert>Latency issues are frequently temporary and if you do not gather this information at the time of the incident it will prevent deeper analysis.</div><h3 id=1-enable-hop-monitoring>1. Enable Hop Monitoring</h3><p><strong>Requires permissions to modify the edge node config. If your user is read-only skip to <a href=/tutorials/operations-runbook/latency-troubleshooting/#2-run-mtr-to-reported-gateway>Step 2</a>.</strong></p><p>Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it&rsquo;s attached gateways. Follow the steps the <a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/#enabling-network-hop-monitoring>Enable Network Hop Monitoring</a> to enable hop monitoring.</p><h3 id=2-run-mtr-to-reported-gateway>2. Run MTR To Reported Gateway</h3><p>This step should</p><ol><li>Navigate to the <a href=/docs/nodes/appliances/data-plane/>data plane panel</a> edge node (not the gateway) that is reporting high latency.</li><li>From the list of peers click the peer gateway with which the edge node is experiencing high latency.</li><li>Click the &ldquo;MTR&rdquo; button on the right side of the table in that row. This will open a prompt with the gateway&rsquo;s IP address and port pre-populated and the protocol set to TCP.</li><li>Change the following settings:<ul><li>Change the DNS field to either &ldquo;Show IPs and Hostnames&rdquo; or &ldquo;Show IPs only&rdquo;. Note: if the node is having DNS health issues showing host names will slow down the response from MTR.</li><li>Change ping count to 30. This will give you more data points with a potential to identify the hop in the path introducing problems.</li><li>Select &ldquo;Use Report Mode&rdquo;. This will cause the MTR to run in a silent mode, but when it completes the results stay visible in the window.</li><li>Click Execute.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=mtr-settings.png alt="MTR Settings" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:60%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>Recommended MTR Settings</figcaption></figure></li></ul></li><li>When the MTR window first opens it will show only the word &ldquo;Start&rdquo; followed by the date and time (UTC timezone). This will stay for approximately 30-40 seconds while the data is gathered in the background. This is normal.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=mtr-start.png alt="MTR Start" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:60%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>MTR Start</figcaption></figure>.</li><li>After MTR completes testing the results will be displayed and the words &ldquo;Session Closed&rdquo; will appear. Capture this data either with a screenshot or by copying and pasting the text into a text file.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=mtr-results.png alt="MTR Results" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:80%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>MTR Results</figcaption></figure></li></ol><div class="alert alert-primary" role=alert><h4 class=alert-heading>What if the MTR Results are blank?</h4><p>MTR and Trustgrid&rsquo;s hop monitoring feature both rely on the node receiving ICMP TTL (time to live) exceeded messages from the various routers (or hops) along the path.</p><ul><li>If you are seeing no responses or only the first and last hop, then it is likely a firewall in front of the node is blocking the ICMP responses. You would need to work with the site technical contact to allow these response back to the node. Allowing this traffic differs depending on the type of firewall but search for &ldquo;allowing traceroute responses&rdquo; or &ldquo;allowing ICMP responses&rdquo; to find the correct setting is usually helpful.</li><li>If you are seeing responses up to a certain point and then several missing/blank hops this is because there is no requirement for all routers to respond. Public clouds like AWS and Azure do not respond once the traffic has entered their networks.</li></ul></div><h3 id=3-check-latency-to-other-gateways>3. Check Latency to Other Gateways</h3><p>The Data Plane panel shows the tunnel latency to all connected peers.</p><ol><li>If the reported gateway is a member of a cluster, click the other name of the other cluster member to see if it is impacted as well.<ul><li>It is common that the latency will be more severe on the active/master member of the cluster because it is under more load with more packets that could be impacted.</li><li>If high latency is seen to both members of the cluster, then it is likely a problem with the internet path than an issue with the gateway or edge node itself.</li></ul></li><li>If the node is connected to other gateways in different regions, check the latency to those gateways as well.<ul><li>If the latency to the other gateways is also high, this indicates a problem closer to the edge node like the site ISP.</li></ul></li></ol><h3 id=4-clustered-edge-nodes-only-check-latency-from-cluster-peer>4. (Clustered Edge Nodes Only) Check Latency from Cluster Peer</h3><p>If the reporting edge node is a member of a cluster, check the latency from the other cluster member to the same gateway.</p><ol><li>Navigate to the Data Plane panel on the other member of the clusters.</li><li>Repeat <a href=/tutorials/operations-runbook/latency-troubleshooting/#3-check-latency-to-other-gateways>Step 3</a>. to see if the other member of the cluster is impacted as well.<ul><li>If the latency to the other cluster member is also high, this indicates a problem closer to the edge node like the site ISP.</li><li>If the latency to the other cluster member is normal, check to see if it is using a different ISP than the reporting edge node by viewing the ISP field in the <a href=/docs/nodes/shared/location/>Location</a> panel. <strong>If the cluster member is using a different ISP, making the non-impacted member the active member of the cluster will likely restore normal functionality while the impacted member&rsquo;s ISP issue is investigated further.</strong></li></ul></li></ol><h3 id=5-run-data-plane-performance-test>5. Run Data Plane Performance Test</h3><p>You can utilize the Data Plane Performance Tool to test the bandwidth and performance of the tunnel between the edge node and the gateway. This can help identify if the issue is bandwidth congestion or if it is only impacting traffic in one direction.</p><ol><li>Navigate to the Data Plane panel on the impacted edge node.</li><li>Click the <a href=/docs/nodes/appliances/data-plane/#data-plane-performance-tool>&ldquo;Test Performance&rdquo; button</a> in the row with one of the impacted gateways. This tool tests <strong>sending</strong> data from the current node to the selected peer/gateway.<ul><li>If one of the impacted gateways is not currently the active member of its cluster this will allow for testing without concern of impacting production traffic.</li></ul></li><li>Start with the default value of 10 MB to send. If the test completes very quickly, increase the amount of data to send but keep in mind you are consuming bandwidth.</li></ol><h2 id=post-incident-triage-steps>Post Incident Triage Steps</h2><p>If the incident has resolve itself there will be a limit to the information that can be gathered. For example, running MTR on the impacted node will not provide any information because the node is no longer experiencing the issue. The steps below are intended to determine what information is available and set up having more information if the issue reoccurs.</p><p>Before starting, determine the start and end time of the incident. Be aware that the portal will display most things using your browsers local timezone, but timestamps send via <a href=/docs/alarms/channels/>alarm channels</a> will be in UTC time. As are any timestamps in <a href=/help-center/ops-logs/debug-logs/>debug logs</a>.</p><h3 id=1-enable-hop-monitoring-1>1. Enable Hop Monitoring</h3><p><strong>Requires permissions to modify the edge node config. If your user is read-only skip to <a href=/tutorials/operations-runbook/latency-troubleshooting/#2-run-mtr-to-reported-gateway>Step 2</a>.</strong></p><p>Hop monitoring uses TCP SYN packets to continuously monitor the path between an edge node and all it&rsquo;s attached gateways. Follow the steps the <a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/#enabling-network-hop-monitoring>Enable Network Hop Monitoring</a> to enable hop monitoring. Enabling after the incident will provide more data if the issue reoccurs.</p><p>If the impacted edge node is a member of a cluster, enable hop monitoring on the other member of the cluster as well.</p><h3 id=2-use-data-plane-panel-to-view-latency-to-gateways>2. Use Data Plane Panel to View Latency to Gateways</h3><p>The Data Plane panel can be used to view the tunnel latency to all connected peers ( and hop monitoring data if enabled ) up to the past 90 days. To view data from the past:</p><ol><li>Navigate to the Data Plane panel on the impacted edge node.</li><li>Click on one of the impacted gateway&rsquo;s name to view the latency to that gateway.</li><li>By default, the data for the last hour is show. Under Monitoring click <strong>Custom</strong> in the time selector.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=post-incident-investigate-1.png alt="Data Plane panel Monitoring time selector" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:70%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>Custom date/time selector</figcaption></figure></li><li>Use the time selector to select a time range that includes the incident and click <strong>Apply</strong>. It is a good idea to include 15-30 minutes before the incident started and after the incident ended.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=post-incident-investigate-2.png alt="Data Plane panel custom time selector" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:70%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>Example date/time selection process</figcaption></figure></li><li>This will show the latency to the selected gateway over the selected time range.<ul><li>If hop monitoring was enabled, clicking any point on the graph will update to show the data collected at that time.
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=post-incident-investigate-3.png alt="Data Plane panel latency graph" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:90%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>Historical Tunnel Latency and Network Hop graphs</figcaption></figure></li><li>If you select other peers/gateways, the latency to those gateways will be shown during the same time period.<ul><li>If the gateway is a member of a cluster, view the other member of the cluster to see if it is also impacted.</li><li>Select other gateways in other data centers/regions to see if they are also impacted.</li></ul></li></ul></li></ol><p>Based on the data you collected consult the <a href=/tutorials/operations-runbook/latency-troubleshooting/#latency-issue-matrix>Latency Issue Matrix</a> to determine the likely area of the issue.</p><h2 id=latency-issue-matrix>Latency Issue Matrix</h2><p>The below matrix will assume that</p><ul><li>Edge1 is reporting high latency to East-gw1</li><li>East-gw1 is the active member of a cluster that includes East-gw2, both in the same data center/availability zone</li><li>Edge1 is also connected to West-gw1, the active member of a cluster that includes West-gw2, both in the same data center/availability zone</li><li>Most VPN/Layer 4 traffic is between the East gateways and Edge1</li></ul><p>In each column under the gateway name is what would be shown in the Data Plane panel of Edge1 during the incident (see <a href=/tutorials/operations-runbook/latency-troubleshooting/#2-use-data-plane-panel-to-view-latency-to-gateways>Step 2</a> for how to view other times).</p><table><thead><tr><th>East-gw1</th><th>East-gw2</th><th>West-gw1</th><th>West-gw2</th><th>Likely Cause</th></tr></thead><tbody><tr><td>Consistent high latency</td><td>Periodic spikes of high latency</td><td>Periodic spikes of high latency</td><td>Periodic spikes of high latency</td><td>This indicates an issue with Edge1 or its ISP.<ul><li>Check for high CPU and Memory utilization on Edge1.</li><li>Look at bandwidth usage, if it is plateauing at a certain level (e.g. 50Mbps) it could indicate the internet connection at the site is fully utilized or something is doing traffic shaping.</li><li>Work with the local network IT contact to have them open a ticket with their ISP.</li></ul></td></tr><tr><td>Consistent high latency</td><td>Periodic spikes of high latency</td><td>No latency</td><td>No Latency</td><td>This indicates a problem with the internet path between the East gateways and Edge1.</td></tr><tr><td>Consistent high latency</td><td>No latency</td><td>No Latency</td><td>No latency</td><td>This indicates either an issue with East-gw1 or a problem with the internet path between the East gateways and Edge1.<ul><li>Check for high CPU and Memory utilization on East-gw1.</li><li>Look at bandwidth usage, if it is plateauing at a certain level (e.g. 50Mbps) it could indicate the internet connection at the site is fully utilized or something is doing traffic shaping.</li><li>Pull <a href=/help-center/ops-logs/debug-logs/>debug logs</a> from East-gw1 and Edge1 and look for errors.</li><li>You could force a <a href=/docs/nodes/appliances/data-plane/#peer-disconnect>peer disconnect</a> but this will disrupt traffic over the connection</li></ul></td></tr></tbody></table><p>If Edge1 is the active member of a cluster <strong>and both members of the cluster are using the same ISP</strong> (typically using the public IPs will be the same or adjacent), the expected behavior would be that both members see the latency, but the latency will be higher and more consistent on Edge1 because it has more traffic.</p><p>If Edge1 is the active member of a cluster <strong>and the member use different ISPs</strong> (typically using the public IPs will be different) a few scenarios are possible:</p><ul><li>If the local ISP for Edge1 is the source of the issue, you would not see any latency on the other member of the cluster. It would be recommended to promote the other member as the active member of the cluster.</li><li>If the issue lies closer to the gateways internet connect, you wil likely see latency on both members of the cluster but it will be more pronounced on the active member because it has more traffic.</li></ul><h2 id=advanced-troubleshooting-steps>Advanced Troubleshooting Steps</h2><p>The steps below can help gather more data but may require allowing additional traffic between the gateway and edge nodes.</p><h3 id=determine-path-mtu-with-ping>Determine Path MTU with Ping</h3><p>The MTU is the maximum size of a packet that can be transmitted over a network. On the internet the default is 1500 bytes. If the MTU is too small on a router between the nodes packets can be fragmented, which can cause delays and packet loss. It is important to test in both directions because routing can be different in each direction.</p><ol><li>Make sure ICMP is allowed between the gateway and edge nodes in both directions. Verify that it is allowed by pinging each node&rsquo;s public IP from the other node. Replace the <code>xx.xx.xx.xx</code> with the target public IP.<div class=codeblock-container><pre><code>ping xx.xx.xx.xx</code></pre><button onclick=copyToClipboard(this)>Copy</button></div><script>function copyToClipboard(e){var t=e.previousElementSibling.textContent;navigator.clipboard.writeText(t).then(function(){console.log("Text copied to clipboard")}).catch(function(e){console.error("Could not copy text: ",e)})}</script><style>.codeblock-container{position:relative;display:flex;align-items:center}.codeblock-container pre{margin:0;font-family:monospace;background-color:#f4f4f4;padding:10px;border-radius:5px;flex-grow:1}.codeblock-container button{margin-left:10px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer;&:active { background-color:rgb(200,200,200); }}</style><div class="alert alert-info" role=alert>If the edge node is being NAT&rsquo;d to a public IP the site technical contact should make sure that the device hosting the public IP responds to ICMP ping messages.</div></li><li>Run ping with flags specified to determine the MTU. Replace the <code>xx.xx.xx.xx</code> with the target public IP.<div class=codeblock-container><pre><code>ping -s 1472 -M do -c 1 xx.xx.xx.xx</code></pre><button onclick=copyToClipboard(this)>Copy</button></div><script>function copyToClipboard(e){var t=e.previousElementSibling.textContent;navigator.clipboard.writeText(t).then(function(){console.log("Text copied to clipboard")}).catch(function(e){console.error("Could not copy text: ",e)})}</script><style>.codeblock-container{position:relative;display:flex;align-items:center}.codeblock-container pre{margin:0;font-family:monospace;background-color:#f4f4f4;padding:10px;border-radius:5px;flex-grow:1}.codeblock-container button{margin-left:10px;padding:5px 10px;border:none;border-radius:5px;cursor:pointer;&:active { background-color:rgb(200,200,200); }}</style><ul><li>The <code>-s</code> flag specifies the data payload size of the packet to be sent. The default value is 56 bytes. For this test we will use 1472 because that plus the IP header size of 28 bytes is 1500 bytes, the internet default.</li><li>The <code>-M do</code> tells ping to attempt to do path MTU discovery by disabling fragmentation.</li><li>the <code>-c</code> flag specifies the number of packets to send. This can be omitted if you think the MTU issue is intermittent and want to leave the ping running.</li></ul></li><li>Repeat the above step from the other node using the peers public IP.</li></ol><h4 id=successful-ping-path-discovery>Successful Ping Path Discovery</h4><p>If the ping succeeds, the output will look similar to the following:
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=ping-mtu-success.png alt="MTU Ping Successful" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:70%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>MTU Ping Successful</figcaption></figure></p><h4 id=failed-ping-path-discovery>Failed Ping Path Discovery</h4><p>If the ping fails, the output will look similar to the following:
<script src=/js/fullscreen.js></script><figure class=centered-image><img src=ping-mtu-failed.png alt="MTU Ping Failed" onclick=toggleImageSize(this) style=display:block;margin-left:auto;margin-right:auto;width:70%><figcaption style=text-align:center;margin-top:.5rem;font-weight:lighter>MTU Ping Failed</figcaption></figure>A few things to notice:</p><ul><li>The first line displays the payload size, 1500 bytes, and then the resulting <strong>packet size</strong> of 1528 bytes after the header information is included. The size of the header can vary depending on the options used to send the packet.</li><li>The ping error shows the recommended MTU size of 1500 bytes.</li></ul><p>If recommended MTU size is lower than 1500 you have a few options:</p><h5 id=work-with-the-isp-andor-local-networking-team-to-increase-the-mtu-of-the-path>Work with the ISP and/or local networking team to increase the MTU of the path.</h5><p>This involves using MTR to identify the point in the path that is rejecting the large packets. Run MTR from the same node you ran the ping from with the following options:
- Protocol: ICMP
- Hostname: The public IP of the node you are pinging
- Ping Count: 1 (or more if you think it is intermittent)
- Use Report Mode: checked
- Advanced options <code>-s 1472</code>
- All other options at default and Execute</p><p>You should see at some point the packets start failing and that indicates that the hop listed is rejecting the packets or a hop before is the issue.</p><h5 id=change-the-wan-interface-mtu>Change the WAN Interface MTU</h5><p><a href=/docs/nodes/appliances/interfaces/#mtu>Change the MTU of the WAN interface</a> of the edge node to the lower value recommended. If the node is offline, you can also <a href=/tutorials/local-console-utility/advanced-network-config/#change-interface-mtu>change the MTU via the console</a>.</p><p>The upside of this approach is that you should be able resolve the issue immediately. The downside is a potential small decrease in throughput and that both changes will require a restart of the node service which is disruptive.</p><div class="alert alert-warning" role=alert>Adjusting the MTU size of a gateway node is discouraged as this will impact <strong>all nodes connected to that gateway.</strong></div><h2 id=faq>FAQ</h2><h3 id=what-is-high-tunnel-latency-and-what-are-common-causes>What is High Tunnel Latency and what are common causes?</h3><p>High tunnel latency is a condition where the time it takes for data to travel between gateway and edge nodes is significantly longer than normal. This can be caused by a variety of factors, including packet loss and latency on the internet between the gateway and edge nodes, or tunnel traffic exceeding the hardware capabilities of the gateway or edge node.</p><p>Packet loss and latency can occur on the internet due to various factors, including network congestion, inadequate bandwidth, and routing inefficiencies. When data is transmitted between a source internet source provider (ISP) and a destination ISP, the two may have different peering relationships—either direct peering, where they exchange traffic directly, or transit relationships, where one ISP pays another to carry its traffic. These relationships can influence the speed and reliability of data transfer. For instance, if there is congestion at a peering point or if the transit path is suboptimal, packets may be delayed or lost altogether, leading to higher latency and poor VPN performance.</p><h3 id=latency-tcp-vs-udp-tunnels>Latency TCP vs UDP Tunnels</h3><p>While both TCP and UDP traffic on the internet would be subject to the same latency issues, the way the data is transmitted and received can impact the perceived latency. Packet loss has a more significant impact on a TCP-based VPN tunnel compared to a UDP-based tunnel due to the fundamental differences in how these protocols handle data transmission.</p><p>TCP is designed for reliability, ensuring that all packets are delivered in the correct order and without errors. When packet loss occurs in a TCP tunnel, the protocol triggers retransmission of lost packets, which can lead to increased latency and reduced overall throughput. If the application utilizing the tunnel also retransmits lost packets, the latency can be further exacerbated.</p><p>In contrast, UDP prioritizes speed over reliability, allowing packets to be sent without waiting for acknowledgments. This means that while UDP-based VPNs may experience some data loss, they can maintain better performance and lower latency, making them more resilient to packet loss in real-time applications provided the applications utilizing the tunnel properly manage retransmission of lost packets.</p><h3 id=why-does-the-tunnel-show-latency-but-hop-monitor-data-doesnt>Why does the tunnel show latency but hop monitor data doesn&rsquo;t?</h3><p>The biggest difference between the two data sets is that the tunnel latency is based on packets <strong>inside</strong> the tunnel mixed in with all other tunnel traffic, while the hop monitor data is based on packets <strong>outside</strong> the tunnel and does not need to be queued up with other tunnel traffic. If the tunnel is attempting to retransmit dropped packets this will add latency to the the tunnel latency data. This is not the case with the hop monitor data.</p><p>The other difference is that the hop monitor probes are SYN packets with no data payload. If the issue between the gateway and edge node is related to a hop having a smaller than expected MTU (maximum transmission unit) size, the small SYN packet is not going to be impacted. But the queued tunnel traffic will be impacted and delay the tunnel latency probe.</p><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","page_helpful",{event_category:"Helpful",event_label:window.location.pathname,value:e})};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(100)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/trustgrid/docs aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>Trustgrid</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>