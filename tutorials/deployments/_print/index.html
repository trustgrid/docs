<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=https://docs.trustgrid.io/tutorials/deployments/><link rel=alternate type=application/rss+xml href=https://docs.trustgrid.io/tutorials/deployments/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Deployments |</title><meta name=description content="Trustgrid Network Device and API documentation"><meta property="og:title" content="Deployments"><meta property="og:description" content="Trustgrid Network Device and API documentation"><meta property="og:type" content="website"><meta property="og:url" content="https://docs.trustgrid.io/tutorials/deployments/"><meta itemprop=name content="Deployments"><meta itemprop=description content="Trustgrid Network Device and API documentation"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deployments"><meta name=twitter:description content="Trustgrid Network Device and API documentation"><link rel=preload href=/scss/main.min.6911289b253d329975de94bccbb593efad1070b6c5994295bc8c67bcf661e005.css as=style><link href=/scss/main.min.6911289b253d329975de94bccbb593efad1070b6c5994295bc8c67bcf661e005.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/getting-started/><span>Getting Started</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/tutorials/><span class=active>Guides</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/help-center/><span>Help Center</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/release-notes/><span>Release Notes</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.98cb7fd37353bdc6f487c6e6b2ac63fe.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/tutorials/deployments/>Return to the regular view of this page</a>.</p></div><h1 class=title>Deployments</h1><ul><li>1: <a href=#pg-b4372d0404394d7880ccab62b7398289>AWS Requirements for HA Wireguard Cluster</a></li><li>2: <a href=#pg-babdda31d36538ba18809318bb6e3d66>AWS Requirements for HA ZTNA Gateway Cluster</a></li><li>3: <a href=#pg-ecf5e347f65f7bfb202ac608a2e20f2d>Configure HA Trustgrid Gateway Cluster in AWS</a></li><li>4: <a href=#pg-ced9fd24d3e032d3def2aca0be2e6355>Deploy a Trustgrid Node AMI in AWS</a></li><li>5: <a href=#pg-f9b4bb0bebfa94e31f6dfbaf1cde6df3>Deploy to Azure</a></li><li>6: <a href=#pg-ef9aa21319b8de0c7d36e66cb0663a67>Deploy to vSphere</a></li><li>7: <a href=#pg-88919b6dfe830981110e41698ff5dbac>On a Stick Configuration</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-b4372d0404394d7880ccab62b7398289>1 - AWS Requirements for HA Wireguard Cluster</h1><ol><li>Create EC2 Target Group and add both Trustgrid gateways with the target being wireguard server port (Default UDP 51820)</li></ol><p>The health check should be set to http with a path of /status and override traffic port to be port 80.</p><p>Only the active member of the Trustgrid Cluster will respond as healthy to the health check.</p><p><img src=wg-ha.png alt=img></p><p><img src=health-checks.png alt=img></p><ol start=2><li>Create NLB (Network Load Balancer) with listener set to configured UDP wireguard server port (Default 51820) and forwarding to the target group created above. The load balancer should be created as internet facing IPV4 and mapped to the Public facing subnets of the Trustgrid gateways.</li></ol><p><img src=edit-listener.png alt=img></p></div><div class=td-content style=page-break-before:always><h1 id=pg-babdda31d36538ba18809318bb6e3d66>2 - AWS Requirements for HA ZTNA Gateway Cluster</h1><ol><li>Create EC2 target group and add both Trustgrid application gateways with the target being TCP port 80.</li></ol><p>The health check should be for http and the path should be <code>/status</code></p><p>Only the active member of the Trustgrid Cluster will respond as healthy to this check.</p><p><img src=nate-test.png alt=img></p><ol start=2><li>Create an ALB (Application Load Balancer) with the listener set to HTTPS and forwarding to the target group created above. Under secure listener settings apply the SSL Certificate provided by Trustgrid for the application gateways. <code>ELBSecurityPolicy-2016-08</code> is recommended as the default security policy by AWS.</li></ol><p>The load balancer should be created as internet facing IPV4 and mapped to the Public facing subnets of the Trustgrid gateways.</p><p><img src=listener-details.png alt=img></p></div><div class=td-content style=page-break-before:always><h1 id=pg-ecf5e347f65f7bfb202ac608a2e20f2d>3 - Configure HA Trustgrid Gateway Cluster in AWS</h1><ol><li><p>Deploy a pair of Trustgrid gateways. Deployment guide includes an example Cloud Formation template that can be used directly or customized for your environment or converted to Terraform if preferred. Gateways can be deployed in the same availability zone or different ones to provide greater redundancy across AWS. <a href=https://docs.trustgrid.io/tutorials/deployments/deploy-aws-ami/>Deploy a Trustgrid Node AMI in AWS</a>.</p></li><li><p>Under networking > clusters create a cluster using a descriptive and unique name as seen below.
<img src=add-cluster.png alt=img></p></li><li><p>Select the cluster that was created and add both gateways to it using the actions drop down button as seen below.
<img src=add-node.png alt=img></p></li><li><p>Configure the cluster heartbeat on each individual gateway node. This is located under system > cluster. The host should be the gateway interface on which you want to configure the heartbeat. This can be either the WAN facing or LAN facing interface. You can see what IP is configured from the node page under interfaces. The port defaults to TCP 9000 but can be any unused TCP port if desired. Security groups for both gateways will need to allow this communication in both directions. Both gateways send a heartbeat to each other on the configured IP and Port to determine if the other member is healthy. If the secondary is not able to get a response from the primary then it will become the active member of the cluster. Once this has been configured both nodes should show as green and healthy in the cluster as seen below.
<img src=cluster-status.png alt=img>
<img src=nodes-list.png alt=img></p><div class="alert alert-primary" role=alert>If deploying gateways in different availability zones then LAN interface routes will need to be added to the cluster for both gateway LAN subnets as seen below. This is to ensure the heartbeat communication is routed over the correct interface instead of going out the WAN interface.</div><p><img src=interfaces.png alt=img></p></li><li><p>Under the cluster > interfaces > eth1 LAN > AWS Route Table Entries add the appropriate CIDR for the edge IP space. This should be the subnet that includes all virtual network IP space configured for edge node sites. For example if you have 100 different edge node sites carved out of 172.16.0.0/16 then you would just add this one CIDR. Once this has been added the route should be created in the routing table that is associated to the gateways LAN interface pointing to the ENI of the active member of the cluster.</p><p>There is an IAM profile that should have been associated to each gateway outlined in the deployment guide providing them permissions to manage the routes defined in the AWS Route Table Entries. When a failover event occurs an API Call is made to update the route to point to the ENI of the active member of the cluster.</p><p>This concludes the cluster configuration specifics for AWS deployment. Appropriate VPN configuration will need to be applied in order for traffic to pass end to end between the gateways and edge node sites.</p></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-ced9fd24d3e032d3def2aca0be2e6355>4 - Deploy a Trustgrid Node AMI in AWS</h1><p>Standing up a Trustgrid node in AWS is easy using an Amazon AMI. Trustgrid nodes in AWS use two network interfaces - a management and data interface. The management interface communicates with Trustgrid Cloud Management systems. The data interface is used to terminate TLS tunnels from Edge Nodes.</p><h2 id=notes>Notes</h2><ul><li>The cloudformation template below works with an AMI currently published in US-EAST1. Deploying in other regions requires working with Trustgrid Support</li><li>Logs /var/log/syslog, /var/log/secure, and /var/log/trustgrid/tg-default.log to CloudWatch</li><li>Requires VPC and public subnet</li><li>Does not create security groups or roles - those have to be managed separately (more below)</li></ul><div class="alert alert-primary" role=alert><p>If using a burstable performance instance types (T2, T3 and T3a) the following is advised:</p><ul><li><p>Set CPU Credits for all Gateway instances to unlimited to allow CPU to burst in the event there is a spike above the normal threshold. <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-unlimited-mode.html>Unlimited mode for burstable performance instances - Amazon Elastic Compute Cloud</a></p></li><li><p>Configure monitoring of your CPU Credit Balance to alert if your credits are being consumed or you are being charged for additional CPU usage which might warrant resizing your devices. <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/burstable-performance-instances-monitoring-cpu-credits.html>Monitor your CPU credits - Amazon Elastic Compute Cloud</a></p></li></ul></div><h2 id=prerequisites>Prerequisites</h2><ul><li><p>VPC with public and private subnets - Management NIC goes in the public subnet, Data NIC goes in the private subnet</p><ul><li>Note: If doing a multi-AZ cluster deployment the private subnets need to use the same route table for automated route management to work</li></ul></li><li><p>Security group for management NIC that allows the following traffic:</p><ul><li>Inbound traffic on designated Trustgrid gateway port (typical TCP 8443) for remote nodes. Access to this port can be secured to only allow access from remote nodes if desired. This is only required if deploying a Trustgrid gateway. If the node is acting as an edge then no inbound access is required.</li><li>Outbound traffic to Trustgrid’s control plane IP (TCP 80/443 & 8443 to 35.171.100.16/28 & 34.223.12.192/28)</li><li>Outbound traffic to AWS API (TCP 443) <a href=https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html>https://docs.aws.amazon.com/general/latest/gr/aws-ip-ranges.html</a></li><li>Inbound & Outbound to/from management NIC security group on cluster port (typically TCP port 9000)</li><li>For the initial deployment outbound access for TCP 80/443 should be allowed. Upon successful registration with the Trustgrid Portal this can be removed.</li></ul></li><li><p>IAM role for the instance with policies allowing publishing to Cloudwatch logs and changes to the routing table of the data NIC - See attached doc</p></li><li><p>All Interfaces on the Trustgrid Gateway should have source / destination check disabled in AWS</p></li><li><p>Security group for data NIC - No configuration for now</p></li><li><p>An IP in the private subnet that will be used by the data NIC</p></li><li><p>An SSH keypair that can be used to SSH to the instance if necessary</p></li><li><p>VPC must have unallocated public IP that will be claimed during provisioning</p></li></ul><h2 id=process>Process</h2><ol><li><p>Create a new Node. When complete the Node license will copy to clipboard.</p><ul><li>Note: The node will not be visible in the portal until the registration process is complete.</li><li>Download the license to local storage in case the clipboard is cleared. You cannot reissue a license without recreating the node.</li></ul></li><li><p>Click this link to start the AMI provisioning process. <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json">https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://s3.amazonaws.com/tg-dev-public/cf-trustgrid-node.json</a></p></li><li><p>Fill out the fields in the CloudFormation form</p></li></ol><h2 id=instance-configuration>Instance Configuration</h2><tr id=stack-name><th>Stack Name</th><td>Unique name to describe this deployment</td></tr><tr id=instance-type><th>Instance Type</th><td>Set the instance type of the EC2 instance to deploy (bigger instances cost more)</td></tr><tr id=host-iam-role><th>Host IAM Role</th><td><p>An EC2 associated role that allows creating and writing to CloudWatch logs. Only the role name itself is required.</p><p>The role needs these IAM privileges: <code>logs:CreateLogGroup</code>, <code>logs:CreateLogStream</code>, <code>logs:PutLogEvents</code>, <code>logs:DescribeLogStreams</code> on resource <code>arn:aws:logs:*:*:*</code></p><p>Cloudwatch logs policy</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;Version&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;2012-10-17&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>&#34;Statement&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:CreateLogGroup&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:CreateLogStream&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;logs:PutLogEvents&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;*&#34;</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>If EC2 Nodes will be clustered (Layer 3) the IAM role needs <code>ec2:DescribeRouteTables</code> for any resource and <code>ec2:CreateRoute</code> & <code>ec2:DeleteRoute</code> on the route table</p><p>Route Table Policy</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ec2:DescribeRouteTables&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;*&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>,</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Effect&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Allow&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Action&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>		<span style=color:#4e9a06>&#34;ec2:CreateRoute&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>		<span style=color:#4e9a06>&#34;ec2:DeleteRoute&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;Resource&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;arn:aws:ec2:us-east-1:079972220921:route-table/rtb-f428d58b&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p><strong>NOTE</strong>: Set the Resource field to the ARN of the Routing Table associated with the data NICs of the instance.</p><p><strong>CloudWatch Note</strong>: We will create log groups named /trustgrid/var/log/syslog and /trustgrid/var/log/trustgrid/tg-default.log.</p></td></tr><tr id=ssh-keypair><th>SSH Keypair</th><td><p>SSH keypair to SSH to the instance as ubuntu user if necessary</p><p><strong>NOTE</strong>: SSH access requires a security group change allowing access. We strongly recommend that SSH is not allowed from anywhere (0.0.0.0/0).</p></td></tr><h2 id=management-configuration>Management Configuration</h2><tr id=security-group><th>Security Group</th><td>Needs to allow outbound traffic to other gateways and our public IP range, at a minimum. If it&rsquo;s a gateway node, needs to allow inbound access on desired gateway port.</td></tr><tr id=subnet><th>Subnet</th><td>The VPC subnet to put the EC2 instance in. This needs to be a subnet with public IP enables (the instance will automatically claim one; the Auto-Assign Public IP does not need to be enabled)</td></tr><h2 id=data-path-configuration>Data Path Configuration</h2><tr id=security-group><th>Security Group</th><td>The security group for the data path - needs to allow outbound communication to other gateways, and inbound communication on its gateway port</td></tr><tr id=subnet><th>Subnet</th><td>The VPC subnet to put the data interface in - if it&rsquo;s a cloud-accessible gateway, should be a public subnet, if it&rsquo;s only for internal AWS traffic, can be a private subnet. Will need outbound access either through IGW or NAT GW.</td></tr><tr id=data-ip><th>Data IP</th><td>The private IP for the data path - must belong to the subnet</td></tr><h2 id=trustgrid-configuration>Trustgrid Configuration</h2><tr id=security-group><th>Security Group</th><td><p>Copy/paste the license from the portal.</p><p>Note: It is critical that you copy/paste the license correctly.</p></td></tr><div class="alert alert-primary" role=alert>If you are not a direct Trustgrid customer please work with your vendor to get these licenses generated and sent to you.</div><h2 id=creating-the-stack>Creating the Stack</h2><ol><li>Create the stack. Check the box acknowleding that AWS CloudFormation might create IAM resources. This is required because we create an instance profile for the to-be-run EC2 instance.</li><li>When the node appears in the Portal, activate it.</li><li>In the EC2 console, reboot the node (it will be named trustgrid-node)</li><li>You can now manage the node as you would any other in the Portal UI.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-f9b4bb0bebfa94e31f6dfbaf1cde6df3>5 - Deploy to Azure</h1><h2 id=vm-requirements>VM Requirements</h2><table><thead><tr><th>Requirement</th><th>Description</th></tr></thead><tbody><tr><td>OS</td><td>Ubuntu 18.04 LTS</td></tr><tr><td>Disk Size</td><td>At least 30 GB</td></tr></tbody></table><h3 id=instance-type>Instance Type</h3><p>Trustgrid has validated using the <a href=https://learn.microsoft.com/en-us/azure/virtual-machines/sizes-b-series-burstable>B-series burstable - Azure Virtual Machines</a> instance type.</p><p>VPN throughput is tied to CPU the recommended size depends on roles, expected throughput.</p><ul><li>For Gateway nodes expecting up to ~200Mbps throughput, Trustgrid recommends the Standard_B4ms or larger</li><li>For Edge nodes expecting less than 100Mbps throughput, Trustgrid recommends the Standard_B2s or Standard_B2ms or larger</li></ul><h3 id=interfaces>Interfaces</h3><p>One WAN interface with a public IP and one LAN interface on a private subnet. The nodes will need to be able to route to all required hosts/applications that need to communicate across the Trustgrid virtual network.</p><p>The LAN interface needs to have <strong>IP Forwarding Enabled</strong> in order to forward the traffic across the tunnel.</p><p><img src=azure-ip-config.png alt="IP Forwarding"></p><p>See <a href=https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-udr-overview>Azure virtual network traffic routing</a>.</p><h3 id=network-access>Network Access</h3><blockquote><p>During deployment only, Trustgrid will need direct SSH access from their provisioning system to the VM instances that will be converted into Trustgrid nodes.</p></blockquote><p>For gateways:</p><ul><li>Outbound internet access to the <a href=https://docs.trustgrid.io/help-center/kb/site-requirements/>Trustgrid control plane networks</a> and ability to resolve public DNS names.</li><li>Inbound access required is the TCP port defined for the Trustgrid gateway service to listen on. Edge nodes will connect to the gateways public IP and port defined. The default port used is 8443.</li></ul><p>For edge nodes:</p><ul><li>Outbound internet access to the <a href=https://docs.trustgrid.io/help-center/kb/site-requirements/>Trustgrid control plane networks</a>, outbound access to the IP and ports of the Trustgrid gateways, and ability to resolve public DNS names.</li><li>No inbound access is required on the public interface.</li></ul><p>For all clustered nodes:</p><ul><li>The cluster heartbeat runs on the LAN/inside interface on TCP Port 9000. This port will need to be open between both Trustgrid Gateways for failover to work correctly.</li></ul><h3 id=admin-username-and-ssh-key>Admin Username and SSH Key</h3><p>Trustgrid requires SSH access to the deployed VM to complete the Trustgrid deployment process. After the deployment is complete the VM ceases to listen on port 22 and any external access to that port can be revoked.</p><ul><li><p>Username: <code>ubuntu</code></p></li><li><p>SSH public key:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDK1AHNLfqOd13qsWQGa4FgoNcpllJYlIlkJdqCkLFq0qaYVrh0b1mxalVzrrxy8rSj7DYlofRArb9hntijLnkrlKxMcWVgqMg4JAcXEQvWUtkIwFemE/NoZoXncKfr6lJZ/+gT1LhNX7IMUh7vVhYsyhDkbdvU0FcnJVelEW5TCRdPLzTMcbRfjCo6MiCoMK45nQIKRHofAJFPSubmPAKZC0L1Dz4zwnb1PeCadSDRHDwPWB3vCl9H/h+7Oe7TC+kEc4bV8OzZTnzfX4Mdo9rb9Afz3ZFWYYh3KP2v1hsF6rtSLS6EpuMZVS41YHvGpHQjFgn0n8hNIoQvf9gO4hxH</span></span></code></pre></div></li></ul><h2 id=requirements-for-ha-failover>Requirements for HA Failover</h2><h3 id=azure-routing-table>Azure Routing Table</h3><p>An Azure routing table resource needs to be associated with the LAN interface&rsquo;s subnet.</p><h4 id=view-lan-subnet-routing-table>View LAN Subnet Routing Table</h4><ol><li><p>In the Azure Portal search for Virtual Networks and select the service</p></li><li><p>From the list of Virtual Networks select your target Virtual Network</p></li><li><p>From the navigation panel select Subnets</p></li><li><p>Select your inside/private subnet that is attached to the LAN interface of your Trustgrid VMs</p></li><li><p>There should be a route table</p><p><img src=azure-route-table.png alt="Route Table"></p></li></ol><h4 id=create-route-table-for-lan-subnet>Create Route Table for LAN Subnet</h4><ol><li><p>If there is no Route Table associated with your LAN/inside/private subnet you will need to add it.</p></li><li><p>In the Azure portal search for Route Tables and select the service</p></li><li><p>Click the +Create button</p></li><li><p>Select the Resource Group that contains your Virtual Network and VMs</p></li><li><p>Select the Region that your VMs are deployed in</p></li><li><p>Give the Route Table a name consistent with your naming conventions</p></li><li><p>(Optional) change the Propagate Gateway routes option.</p><p><img src=propagate-routes.png alt="Propagate Routes Option"></p></li><li><p>Click Review + Create, review then click Review + Create again</p></li><li><p>Repeat the above steps to “View LAN Subnet Routing Table” and change the route table from None to the newly created Route Table.</p></li><li><p>Save the change</p></li></ol><h3 id=permissions-required-for-cluster-route-failover>Permissions Required for Cluster Route Failover</h3><p>Copy this sample json file for use in creating a custom role with the required permissions. See process below.</p><blockquote><p>The assignableScopes section will need to be modified to represent the resource information of the target Azure account.</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>	<span style=color:#204a87;font-weight:700>&#34;properties&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&#34;roleName&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;tg-route-table&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&#34;description&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;manage azure route table&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&#34;assignableScopes&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>		<span style=color:#204a87;font-weight:700>&#34;permissions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>			<span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&#34;actions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/networkWatchers/nextHop/action&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/networkInterfaces/effectiveRouteTable/action&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/routes/delete&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/routes/write&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/routes/read&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/join/action&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/delete&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/write&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/routeTables/read&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/networkInterfaces/read&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Network/virtualNetworks/read&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>					<span style=color:#4e9a06>&#34;Microsoft.Compute/virtualMachines/read&#34;</span>
</span></span><span style=display:flex><span>				<span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&#34;notActions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[],</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&#34;dataActions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[],</span>
</span></span><span style=display:flex><span>				<span style=color:#204a87;font-weight:700>&#34;notDataActions&#34;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>			<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>		<span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>	<span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span></span></span></code></pre></div><ol><li><p><a href=https://learn.microsoft.com/en-us/azure/active-directory/managed-identities-azure-resources/qs-configure-portal-windows-vm>System-assigned Managed Identity</a> needs to be enabled for both VMs in the cluster.</p><p><img src=system-managed-identity.png alt="System-assigned Managed Identity"></p></li><li><p>A custom role needs to be created in the Azure subscription that allows the Trustgrid nodes to update the route table when failover occurs</p><ol><li>Create the custom role<ol><li><p>In the Azure portal search for “Subscriptions” and select the Subscriptions service</p></li><li><p>Select the subscription that contains the Trustgrid VMs</p></li><li><p>Select “Access control (IAM),” then click “+Add”, then “Add custom role”</p><p><img src=add-custom-role.png alt="Add Custom Role"></p></li><li><p>Save the JSON above to a file named <code>azure-custom-role-sample.json</code>.</p></li><li><p>Select “Start from JSON” and from the file selector, select the downloaded json file.</p><p><img src=create-custom-role.png alt="Create Custom Role"></p></li><li><p>Optionally, update the role name to meet your internal naming conventions.</p></li><li><p>Click <code>Next</code>.</p></li><li><p>On the Permissions page you will see the permissions that will be granted. Click <code>Next</code> again.</p></li><li><p>On the Assignable Scopes page click +Add Assignable Scope</p><ol><li><p>From the Type select Resource Group</p></li><li><p>From the Subscription, select the subscription your VMs and virtual networks are in.</p></li><li><p>From the Select pane on the right search for and select the Resource Group containing you VM’s</p><p><img src=select-group.png alt="Resource Group"></p></li><li><p>Click <code>Select</code> and then <code>Next</code>.</p></li></ol></li><li><p>On the JSON page, click the <code>Next</code> button.</p></li><li><p>Click Review + Create, then click Create.</p></li></ol></li></ol></li><li><p>Assign the custom role to your Trustgrid VM’s system-assigned</p><ol><li><p>In the Azure portal search for Resource Groups and select the service</p></li><li><p>Select your target Resource Group</p></li><li><p>Select the Access Control (IAM) panel, then click +Add, then “Add role assignment”</p><p><img src=add-role.png alt="Add Role Assignment"></p></li><li><p>Search for and select the desired role and click Next</p><p><img src=role-list.png alt="Find Role"></p></li><li><p>Under “Assign access to” select “Managed Identity” then click +Select members</p><p><img src=select-members.png alt="Select Members"></p></li><li><p>From the Managed Identity dropdown select Virtual Machine</p></li><li><p>Select the identity for your first Trustgrid VM</p><p><img src=subscriptions.png alt=Subscription></p></li><li><p>Click select.</p></li><li><p>Click +Select members again and repeat with your second Trustgrid VM</p></li><li><p>Click “Review + Assign” then “Review + Assign” a second time</p></li></ol></li></ol><blockquote><p>These permissions can take some time to go into effect.</p></blockquote><h2 id=deployment-process>Deployment Process</h2><p>The current deployment process involves Trustgrid and the site’s technical team with Azure access working together to complete converting a standard Ubuntu 18.04 LTS based VM into a Trustgrid Appliance (or appliances for a clustered deployment).</p><h3 id=participants>Participants</h3><ul><li>Site Tech - User(s) with permissions to deploy new instances in Azure, create the required Managed System Identity shown above, and make changes to allow the required network connectivity</li><li>Trustgrid Tech - Trustgrid professional services team member that will complete the conversion of the generic image into a</li></ul><blockquote><p>If the Site Tech is not part of the organization that is Trustgrid&rsquo;s direct customer, Trustgrid will need documented approval from that customer before proceeding with assisting in the deployment.</p></blockquote><h3 id=high-level-process>High-Level Process</h3><ol><li>Prior to a scheduled call the Site Tech can:<ol><li>Build a vNet with public and private subnets if it does not already exist</li><li>Create the Managed System Identify permissions as defined above</li><li>Create VM Instances based of the Ubuntu 18.04 LTS image and sizing requirement mentioned above</li></ol></li><li>A conference call will be scheduled between the Site Tech and Trustgrid Tech during business hours</li><li>During the conference call:<ol><li>Trustgrid Tech -<ol><li>Confirm connectivity to the node</li><li>Run automation process to convert into Trustgrid appliance</li><li>Register the device with the target organization</li><li>Confirm healthy functionality and connectivity to the required</li><li>Configure and test clustering including route failover (if clustering is to be used)</li><li>Configure VPN (if to be used) and confirm access to required networks/hosts if possible</li></ol></li><li>Site Tech -<ol><li>Revoke direct SSH access</li></ol></li></ol></li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-ef9aa21319b8de0c7d36e66cb0663a67>6 - Deploy to vSphere</h1><h2 id=requirements>Requirements</h2><h3 id=hardware-resources>Hardware Resources</h3><ul><li>4 vCPU</li><li>4 GB RAM</li><li>30 GB disk space</li></ul><h3 id=software-requirements>Software Requirements</h3><ul><li>vSphere 6.7 or newer (with VMWare support)</li></ul><h2 id=configuration-best-practices>Configuration Best Practices</h2><h3 id=backups>Backups</h3><p>Trustgrid recommends against backing up virtualized Nodes. Backups that utilize VMware&rsquo;s Data Protection API will initiate a VM Snapshot that will pause all traffic through the VM for a short period of time. This can cause issues such as master failover in a cluster and disruption of existing network flows.</p><p>In place of backups Trustgrid recommends deploying clustered nodes on different ESX hosts if possible. Nodes can be redeployed and rapidly configured as the configuration is stored in our cloud management system.</p><h3 id=dynamic-resource-scheduling-drs-and-storage-drs>Dynamic Resource Scheduling (DRS) and Storage DRS</h3><h4 id=automation-level>Automation Level</h4><p>Trustgrid recommends setting the DRS level for a VM to either Partially Automated or Disabled. Even the temporary loss of network connectivity during vMotion migrations can disrupt some network flows.</p><ul><li><a href=https://docs.vmware.com/en/VMware-vSphere/6.5/com.vmware.vsphere.resmgmt.doc/GUID-C21C0609-923B-46FB-920C-887F00DBCAB9.html>Set a Custom Automation Level for a Virtual Machine</a></li><li><a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-B560341B-B377-4FA7-BF3B-98A4788AAE3A.html>Change Storage DRS Automation Level for a Virtual Machine</a></li></ul><h4 id=recommended-anti-affinity>(Recommended) Anti-Affinity</h4><p>If you have Trustgrid nodes clustered within a vSphere Cluster with DRS enabled you should create an anti-affinity rule. This rule should keep the nodes running on independent hosts for additional hardware redundancy.</p><ul><li><a href=https://docs.vmware.com/en/VMware-vSphere/6.7/com.vmware.vsphere.resmgmt.doc/GUID-FBE46165-065C-48C2-B775-7ADA87FF9A20.html#GUID-FBE46165-065C-48C2-B775-7ADA87FF9A20>Create VM Anti-Affinity Rules</a></li></ul><h2 id=deployment-process>Deployment Process</h2><p>The Trustgrid gateway node can be deployed in a vSphere environment (v6.7 and higher) using a custom VM template provided by Trustgrid. Follow the instructions below to deploy the OVF template in your environment.</p><ol><li><p>Download & Extract the customized VM template from the link sent to you by Trustgrid</p></li><li><p>Open & log in to your vSphere web client</p></li><li><p>Navigate to Host & Clusters</p></li><li><p>Right click on vSphere ESX host in the Navigator pane and select Deploy OVF Template</p><p><img src=deploy-ovf-template.png alt=img></p></li><li><p>Select Local File and then click Browse</p><p><img src=browse-local-file.png alt=img></p></li><li><p>Select all of the files included in the zip file and click open, then click Next</p></li><li><p>Confirm the name and desired location for your VM and click Next</p><p><img src=name-vm.png alt=img></p></li><li><p>Select a resource to place your VM on and click Next</p><p><img src=select-resource.png alt=img></p></li><li><p>Click Next on the Review Details pane</p><p><img src=review-details.png alt=img></p></li><li><p>Select your preferred storage options and click Next</p><p><img src=select-storage.png alt=img></p></li><li><p>Select the proper networks for your network interfaces.</p><p><img src=select-networks.png alt=img></p><ul><li>The destination network for the first network interface will be the network designated for the node’s management interface. If you opted for a single interface configuration, you will only need this interface connected.</li><li>The destination network for the second network interface will be the network designated for the node’s data interface. If you opted for a single interface configuration you will still need to provide a port group for this to complete the deployment but it can be disconnected after deployment</li></ul></li><li><p>Verify the configuration data and click Finish to deploy the VM</p><p><img src=complete.png alt=img></p></li><li><p>Once your VM Template has finished deployment, power on the VM</p></li></ol><p>Deployment of your Trustgrid gateway node VM is now complete. If configuring this Node as a gateway, the next step will be to allow inbound TCP port 8443 to your gateway VM to allow remote nodes to connect back to it.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-88919b6dfe830981110e41698ff5dbac>7 - On a Stick Configuration</h1><div class="pageinfo pageinfo-primary"><p>Edge nodes can be configured in an &ldquo;on a stick&rdquo; configuration, in which only a single NIC is used for each node. Operating in this mode is supported only when using Layer 3 or Layer 4 configuration where hosts behind gateway nodes need access to data behind edge nodes.</p></div><p>In this configuration, the source IP of traffic from the edge node depends on whether Layer 3 or Layer 4 is being used, as illustrated below.</p><h3 id=layer-3>Layer 3</h3><p>Traffic will originate only from the current active node from the IP address(es) specified in outside NAT rules in the edge node&rsquo;s config.</p><p><img src=l3-stick.png alt=img></p><h3 id=layer-3---routed-single-edge-node>Layer 3 - routed single edge node</h3><p>Trustgrid node(s) used as the next hop in a route for the Trustgrid virtual network. Traffic at the edge will originate from the node&rsquo;s IP address.</p><p><img src=l3-routed.png alt=img></p><h3 id=layer-4>Layer 4</h3><p>Traffic will originate from either edge node with round-robin load-balancing with the source IP address being the IP address of whichever node the traffic originates from.</p><p><img src=l4-stick.png alt=img></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=LinkedIn aria-label=LinkedIn><a class=text-white target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/trustgrid aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Trustgrid All Rights Reserved</small>
<small class=ml-1><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/mermaid@9.2.2/dist/mermaid.min.js integrity="sha512-IX+bU+wShHqfqaMHLMrtwi4nK6W/Z+QdZoL4kPNtRxI2wCLyHPMAdl3a43Fv1Foqv4AP+aiW6hg1dcrTt3xc+Q==" crossorigin=anonymous></script>
<script src=/js/main.min.eb0d5914014c9e8699b3e0109eff69ebdcde4f5e0c80993229a0ebfa76596d0b.js integrity="sha256-6w1ZFAFMnoaZs+AQnv9p69zeT14MgJkyKaDr+nZZbQs=" crossorigin=anonymous></script>
<script src=/js/prism.js></script>
<script src=/js/tabpane-persist.js></script></body></html>