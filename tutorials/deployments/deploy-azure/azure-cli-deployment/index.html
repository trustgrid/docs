<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=alternate type=application/rss+xml href=https://docs.trustgrid.io/tutorials/deployments/deploy-azure/azure-cli-deployment/index.xml><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Azure CLI (az) Deployment | </title><meta name=description content="Details how to deploy a Trustgrid appliance and related resources using the Azure CLI (az) commands."><meta property="og:url" content="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/azure-cli-deployment/"><meta property="og:title" content="Azure CLI (az) Deployment"><meta property="og:description" content="Details how to deploy a Trustgrid appliance and related resources using the Azure CLI (az) commands."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Azure CLI (az) Deployment"><meta itemprop=description content="Details how to deploy a Trustgrid appliance and related resources using the Azure CLI (az) commands."><meta itemprop=wordCount content="1779"><meta name=twitter:card content="summary"><meta name=twitter:title content="Azure CLI (az) Deployment"><meta name=twitter:description content="Details how to deploy a Trustgrid appliance and related resources using the Azure CLI (az) commands."><link rel=preload href=/scss/main.min.6b4aa6c36e8b0e22d882f4a5c8cb692d6f1e05d1eb1dd977c04d40713dadd54b.css as=style><link href=/scss/main.min.6b4aa6c36e8b0e22d882f4a5c8cb692d6f1e05d1eb1dd977c04d40713dadd54b.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><link rel=stylesheet href=/css/prism.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-99793053-3"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-99793053-3")}</script></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll"><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 469 106"><defs><style>.cls-1{fill:#6b6b6b}.cls-2{fill:#226ce0}</style></defs><title>Trustgrid-Logo-Grey</title><path class="cls-1" d="M.35 28.58H29.26V-.33H.35zM7.13 6.45H22.47V21.8H7.13z"/><path class="cls-1" d="M67.82-.33H38.9V28.58H67.82zM61 21.8H45.68V6.45H61z"/><path class="cls-1" d="M.35 67.13H29.26V38.22H.35zM7.13 45H22.47V60.35H7.13z"/><path class="cls-1" d="M106.36 38.22H77.45v12.3H67.82V41.27L85.26 23.83l-3.06-3L64.76 38.22H38.9V67.13H67.82V54.83h9.63v12.3h12.3V80.39h4.31V67.13h12.3zM61 60.35H45.68V45H61zm38.55.0H84.23V45H99.58z"/><path class="cls-1" d="M.35 105.69H29.26V76.77H.35zM7.13 83.55H22.47V98.9H7.13z"/><path class="cls-1" d="M38.9 105.69H67.82V76.77H38.9zm6.78-22.14H61V98.9H45.68z"/><path class="cls-2" d="M153.94 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22H140V38.78h13.2v5.78H140V67q0 3.59 1.31 5.13a4.8 4.8.0 003.91 1.55 13.59 13.59.0 006.67-2z"/><path class="cls-2" d="M176.74 39.56A18 18 0 01186 37.07V44.4q-6.58-.24-10.66 3.42a14.51 14.51.0 00-4.64 9.85V80.39h-7.57V37.32h7.57V46.6a15.52 15.52.0 016-7"/><path class="cls-2" d="M232.34 37.32V80.39h-7.65V71.27q-4.23 9.2-16 9.36-7.48.0-11.72-4.44t-4.24-12.25V37.32h7.66V61.9q0 5.46 3 8.51a10.87 10.87.0 008.18 3.06 12.11 12.11.0 009.57-4.28 16 16 0 003.54-10.7V37.32z"/><path class="cls-2" d="M260.47 44.24a21.21 21.21.0 00-6.15-1 10.48 10.48.0 00-5.49 1.26 4.21 4.21.0 00-2.08 3.87 4.3 4.3.0 002.32 4 34.68 34.68.0 007 2.73 54.86 54.86.0 017.33 2.6 13 13 0 014.85 3.83 10.51 10.51.0 012 6.67 10.58 10.58.0 01-4.6 9.29 19.65 19.65.0 01-11.44 3.17 28.35 28.35.0 01-9.32-1.55 21.07 21.07.0 01-7.61-4.39l2.85-5.54a20.07 20.07.0 006.63 3.91 22 22 0 007.69 1.47 11.45 11.45.0 006-1.39 4.61 4.61.0 002.28-4.23 4.82 4.82.0 00-2.4-4.4 32.85 32.85.0 00-7.29-2.93 48.4 48.4.0 01-7-2.48 12.43 12.43.0 01-4.64-3.71A10 10 0 01239.5 49q0-6 4.4-9a19.07 19.07.0 0111-3 27.13 27.13.0 017.69 1.1 23 23 0 016.56 3l-2.77 5.78a26 26 0 00-5.9-2.6"/><path class="cls-2" d="M303.42 77.54a18.64 18.64.0 01-10.1 3.17 11.44 11.44.0 01-8.3-3c-2.12-2-3.18-5.12-3.18-9.24V44.56h-6.11V38.78h6.11V27.22h7.65V38.78h13.19v5.78H289.49V67c0 2.39.44 4.1 1.3 5.13a4.81 4.81.0 003.91 1.55 13.62 13.62.0 006.68-2z"/><path class="cls-1" d="M352.92 36.34V76.48a19.18 19.18.0 01-3 10.71 19.61 19.61.0 01-8.43 7.08A29.79 29.79.0 01329 96.75a36.74 36.74.0 01-10.66-1.54 34 34 0 01-9-4.16l5.05-10a25.68 25.68.0 006.51 3.17 22.5 22.5.0 007.08 1.14 12.11 12.11.0 007.74-2.27 7.52 7.52.0 002.85-6.2V72.16Q334.12 77.95 326 78a17.69 17.69.0 01-16.41-10.14 24.71 24.71.0 01-2.4-11.12 24.42 24.42.0 012.32-10.91A17.35 17.35.0 01316 38.46a17.92 17.92.0 019.61-2.61A17.42 17.42.0 01333 37.36a14.36 14.36.0 015.5 4.35V36.34zM336.07 64.51a11 11 0 002.44-7.41 11.16 11.16.0 00-2.44-7.49 8.69 8.69.0 00-12.91.0 11 11 0 00-2.48 7.45 10.85 10.85.0 002.48 7.41 8.18 8.18.0 006.47 2.85 8.08 8.08.0 006.44-2.85"/><path class="cls-1" d="M383.9 37.8a16.63 16.63.0 018.26-2V49c-.49.0-1.22-.08-2.2-.08a13.4 13.4.0 00-8.3 2.4A9.18 9.18.0 00378 57.92V80.39H363.5v-44H378v7.33a16 16 0 015.9-5.87"/><path class="cls-1" d="M411.09 18.22a7.55 7.55.0 012.16 5.58 7.59 7.59.0 01-2.16 5.54 8 8 0 01-11 0 7.59 7.59.0 01-2.16-5.54 7.55 7.55.0 012.16-5.58 8.1 8.1.0 0111 0M398.51 36.34h14.41V80.39H398.51z"/><path class="cls-1" d="M468.45 20V80.39H454v-5.7a14.92 14.92.0 01-5.58 4.68A16.94 16.94.0 01440.93 81a20.15 20.15.0 01-10.75-2.85 19.16 19.16.0 01-7.2-8 26.51 26.51.0 01-2.57-11.93 25.77 25.77.0 012.53-11.72A18.6 18.6.0 01430 38.62a20.05 20.05.0 0110.59-2.77 17.24 17.24.0 017.61 1.63A16.19 16.19.0 01454 42.12V20zm-17.1 46.5A11.77 11.77.0 00454 58.57a11.76 11.76.0 00-2.61-8 8.58 8.58.0 00-6.84-3 8.67 8.67.0 00-6.88 3.05A11.69 11.69.0 00435 58.57a11.68 11.68.0 002.64 7.93 8.68 8.68.0 006.88 3.06 8.53 8.53.0 006.84-3.06"/><path class="cls-2" d="M99.58 21.8H84.23V6.46H99.58zM106.36-.33H77.45V28.59h28.91z"/><path class="cls-2" d="M99.58 98.9H84.23V83.55H99.58zm6.78-22.13H77.45v28.92h28.91z"/></svg></span><span class=navbar-brand__name></span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/getting-started/><span>Getting Started</span></a></li><li class=nav-item><a class=nav-link href=/docs/><span>Documentation</span></a></li><li class=nav-item><a class="nav-link active" href=/tutorials/><span>Guides</span></a></li><li class=nav-item><a class=nav-link href=/help-center/><span>Help Center</span></a></li><li class=nav-item><a class=nav-link href=/release-notes/><span>Release Notes</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.8bfbee10d3150a1fc61164ed802fc8ad.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.8bfbee10d3150a1fc61164ed802fc8ad.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorials-li><a href=/tutorials/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-tutorials><span>Guides</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsdeployments-li><a href=/tutorials/deployments/ title="Node Appliance Deployments" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeployments><span>Appliance Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsaws-ha-cluster-li><a href=/tutorials/deployments/aws-ha-cluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-cluster><span>AWS Requirements for HA Wireguard Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster-li><a href=/tutorials/deployments/aws-ha-ztna-gateway-cluster/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsaws-ha-ztna-gateway-cluster><span>AWS Requirements for HA ZTNA Gateway Cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws-li><a href=/tutorials/deployments/configure-ha-gateway-cluster-in-aws/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsconfigure-ha-gateway-cluster-in-aws><span>Configure HA Trustgrid Gateway Cluster in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-aws-ami-li><a href=/tutorials/deployments/deploy-aws-ami/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-aws-ami><span>Deploy a Trustgrid Node AMI in AWS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsdeploymentsdeploy-azure-li><a href=/tutorials/deployments/deploy-azure/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeploymentsdeploy-azure><span>Deploy to Azure</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deployment-li><a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/ title="Azure CLI (az) Deployment" class="align-left ps-0 active td-sidebar-link td-sidebar-link__section" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deployment><span class=td-sidebar-nav-active-item>AZ CLI Deployment</span></a><ul class="ul-4 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deploymentaz-cli-example-li><a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/ title="Example Walkthrough  of Azure CLI (az) Deployment" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azureazure-cli-deploymentaz-cli-example><span>AZ CLI Example Walkthrough</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-azureip-failover-li><a href=/tutorials/deployments/deploy-azure/ip-failover/ title="Azure IP Failover" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azureip-failover><span>IP Failover</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-azureroute-failover-li><a href=/tutorials/deployments/deploy-azure/route-failover/ title="Azure Route Failover" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-azureroute-failover><span>Route Failover</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsdeploy-vsphere-li><a href=/tutorials/deployments/deploy-vsphere/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsdeploy-vsphere><span>Deploy to vSphere</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsdeploymentsros-config-li><a href=/tutorials/deployments/ros-config/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsdeploymentsros-config><span>On a Stick Configuration</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsagent-deploy-li><a href=/tutorials/agent-deploy/ title="Node Agent Deployments" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsagent-deploy><span>Agent Deployments</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsmanagement-tasks-li><a href=/tutorials/management-tasks/ title="Management Operations" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsmanagement-tasks><span>Management Ops</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id=m-tutorialsmanagement-tasksagent-mgmt-li><a href=/tutorials/management-tasks/agent-mgmt/ title="Agent Node Management" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsmanagement-tasksagent-mgmt><span>Agent Management</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksagent-mgmtrestart-agent-li><a href=/tutorials/management-tasks/agent-mgmt/restart-agent/ title="Restart Agent Node Service" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksagent-mgmtrestart-agent><span>Restart Agent</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksagent-mgmtupgrade-agent-li><a href=/tutorials/management-tasks/agent-mgmt/upgrade-agent/ title="Upgrade Trustgrid Agent Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksagent-mgmtupgrade-agent><span>Upgrade Agent Nodes</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-taskschanging-node-status-li><a href=/tutorials/management-tasks/changing-node-status/ title="Changing Node Status (Enabling / Disabling)" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-taskschanging-node-status><span>Changing Node Status</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksrestart-node-li><a href=/tutorials/management-tasks/restart-node/ title="Restart the Trustgrid Service on a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksrestart-node><span>Restart Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksreboot-node-li><a href=/tutorials/management-tasks/reboot-node/ title="Reboot a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksreboot-node><span>Reboot Node</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksupdate-node-config-li><a href=/tutorials/management-tasks/update-node-config/ title="Force Node to Pull Down Configuration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksupdate-node-config><span>Update Node Config</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksupgrade-nodes-li><a href=/tutorials/management-tasks/upgrade-nodes/ title="Upgrading Trustgrid Appliance Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksupgrade-nodes><span>Upgrade Appliance Nodes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksdeleting-nodes-li><a href=/tutorials/management-tasks/deleting-nodes/ title="Deleting Trustgrid Nodes" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksdeleting-nodes><span>Deleting Nodes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsmanagement-tasksdeleting-clusters-li><a href=/tutorials/management-tasks/deleting-clusters/ title="Deleting Trustgrid Clusters" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsmanagement-tasksdeleting-clusters><span>Deleting Clusters</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsoperations-runbook-li><a href=/tutorials/operations-runbook/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsoperations-runbook><span>Operations Runbook</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooklatency-troubleshooting-li><a href=/tutorials/operations-runbook/latency-troubleshooting/ title="Troubleshoot High Tunnel Latency" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooklatency-troubleshooting><span>Latency Troubleshooting</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcluster-failover-response-li><a href=/tutorials/operations-runbook/cluster-failover-response/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcluster-failover-response><span>Cluster Failover Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbookcontrol-plane-disconnect-li><a href=/tutorials/operations-runbook/control-plane-disconnect/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbookcontrol-plane-disconnect><span>Control Plane Disconnect</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooknode-down-response-li><a href=/tutorials/operations-runbook/node-down-response/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooknode-down-response><span>Node Down Response</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsoperations-runbooksite-failover-li><a href=/tutorials/operations-runbook/site-failover/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsoperations-runbooksite-failover><span>Site Failover</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsinterface-tools-li><a href=/tutorials/interface-tools/ title="Network Interface Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsinterface-tools><span>Interface Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolsarping-li><a href=/tutorials/interface-tools/arping/ title="ARP Ping Interface Tool" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolsarping><span>ARP Ping</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolssniff-interface-traffic-li><a href=/tutorials/interface-tools/sniff-interface-traffic/ title="Sniff Traffic Interface Tool" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolssniff-interface-traffic><span>Sniff Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolstcp-port-test-li><a href=/tutorials/interface-tools/tcp-port-test/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolstcp-port-test><span>TCP Port Test</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsinterface-toolstraffic-capture-li><a href=/tutorials/interface-tools/traffic-capture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsinterface-toolstraffic-capture><span>Traffic Capture</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsremote-tools-li><a href=/tutorials/remote-tools/ title="Remote VPN Tools" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsremote-tools><span>VPN Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsping-remote-virtual-host-li><a href=/tutorials/remote-tools/ping-remote-virtual-host/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsping-remote-virtual-host><span>Ping Remote Virtual Host</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolssniff-virtual-traffic-li><a href=/tutorials/remote-tools/sniff-virtual-traffic/ title="Sniff Virtual Traffic" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolssniff-virtual-traffic><span>Sniff VPN Traffic</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsremote-toolsview-virtual-route-table-li><a href=/tutorials/remote-tools/view-virtual-route-table/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsremote-toolsview-virtual-route-table><span>View Virtual Route Table</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialsgateway-tools-li><a href=/tutorials/gateway-tools/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialsgateway-tools><span>Gateway Tools</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers-li><a href=/tutorials/gateway-tools/monitoring-network-hops-to-peers/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsmonitoring-network-hops-to-peers><span>Monitoring Network Hops to Peers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialsgateway-toolsping-remote-node-li><a href=/tutorials/gateway-tools/ping-remote-node/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsgateway-toolsping-remote-node><span>Ping Remote Node</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialswan-interface-ip-li><a href=/tutorials/wan-interface-ip/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialswan-interface-ip><span>Changing the WAN Interface IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsftp-and-ftps-li><a href=/tutorials/ftp-and-ftps/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsftp-and-ftps><span>Configure FTP and FTPS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsconfig-l3-vpn-li><a href=/tutorials/config-l3-vpn/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsconfig-l3-vpn><span>Configure Layer 3 VPN</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialscontainers-li><a href=/tutorials/containers/ title="Container Deployment Walkthrough" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialscontainers><span>Container Deployments</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialscontainersthousand-eyes-li><a href=/tutorials/containers/thousand-eyes/ title="Deploying ThousandEyes Enterprise Agent Container on Trustgrid" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialscontainersthousand-eyes><span>ThousandEyes Agent Container</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialssaml-okta-li><a href=/tutorials/saml-okta/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialssaml-okta><span>Enable SAML with Okta</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialsfind-ip-node-li><a href=/tutorials/find-ip-node/ title="Find the Public IP Address of a Node" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialsfind-ip-node><span>Finding Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-tutorialslimit-node-functionality-li><a href=/tutorials/limit-node-functionality/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslimit-node-functionality><span>Limit Node Functionality to Current Public IP</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-tutorialslocal-console-utility-li><a href=/tutorials/local-console-utility/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-tutorialslocal-console-utility><span>Trustgrid Local Console Utility</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilityadvanced-network-config-li><a href=/tutorials/local-console-utility/advanced-network-config/ title="Advanced Network Configuration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilityadvanced-network-config><span>Advanced Network Config</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilityremote-registration-li><a href=/tutorials/local-console-utility/remote-registration/ title="Remote Console Registration" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilityremote-registration><span>Remote Registration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-tutorialslocal-console-utilitytroubleshooting-li><a href=/tutorials/local-console-utility/troubleshooting/ title="Troubleshooting Menu" class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-tutorialslocal-console-utilitytroubleshooting><span>Troubleshooting</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/trustgrid/docs/tree/main/content/en/tutorials/deployments/deploy-azure/azure-cli-deployment/_index.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/trustgrid/docs/edit/main/content/en/tutorials/deployments/deploy-azure/azure-cli-deployment/_index.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/trustgrid/docs/new/main/content/en/tutorials/deployments/deploy-azure/azure-cli-deployment?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/trustgrid/docs/issues/new?title=Azure%20CLI%20%28az%29%20Deployment" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#deploy-azure-vm-as-trustgrid-appliance>Deploy Azure VM as Trustgrid Appliance</a><ul><li><a href=#declare-required-variables>Declare Required Variables</a></li><li><a href=#capture-latest-trustgrid-image-id>Capture Latest Trustgrid Image ID</a></li><li><a href=#prepare-ssh-key-in-azure>Prepare SSH Key in Azure</a></li><li><a href=#create-network-interfaces>Create Network Interfaces</a></li><li><a href=#create-trustgrid-appliance-vm>Create Trustgrid Appliance VM</a></li><li><a href=#get-mac-address>Get MAC Address</a></li><li><a href=#register-the-vm>Register the VM</a></li></ul></li><li><a href=#additional-steps-for-ha-clusters>Additional Steps for HA Clusters</a><ul><li><a href=#create-additional-vm-appliance>Create Additional VM Appliance</a></li><li><a href=#create-role-for-route-management>Create Role for Route Management</a></li><li><a href=#assign-role-for-route-management>Assign Role for Route Management</a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-categories"><h5 class=taxonomy-title>Categories</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/concepts/ data-taxonomy-term=concepts><span class=taxonomy-label>Concepts</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/data-store/ data-taxonomy-term=data-store><span class=taxonomy-label>Data Store</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/idps/ data-taxonomy-term=idps><span class=taxonomy-label>Idps</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/node/ data-taxonomy-term=node><span class=taxonomy-label>Node</span><span class=taxonomy-count>9</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/overview/ data-taxonomy-term=overview><span class=taxonomy-label>Overview</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/categories/virtual-machines/ data-taxonomy-term=virtual-machines><span class=taxonomy-label>Virtual Machines</span><span class=taxonomy-count>3</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tags</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alarm-filters/ data-taxonomy-term=alarm-filters><span class=taxonomy-label>Alarm Filters</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alarms/ data-taxonomy-term=alarms><span class=taxonomy-label>Alarms</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/alert-suppression/ data-taxonomy-term=alert-suppression><span class=taxonomy-label>Alert Suppression</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/applications/ data-taxonomy-term=applications><span class=taxonomy-label>Applications</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/architecture/ data-taxonomy-term=architecture><span class=taxonomy-label>Architecture</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/channels/ data-taxonomy-term=channels><span class=taxonomy-label>Channels</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster/ data-taxonomy-term=cluster><span class=taxonomy-label>Cluster</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster-health/ data-taxonomy-term=cluster-health><span class=taxonomy-label>Cluster Health</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/cluster-management/ data-taxonomy-term=cluster-management><span class=taxonomy-label>Cluster Management</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/clusters/ data-taxonomy-term=clusters><span class=taxonomy-label>Clusters</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/concepts/ data-taxonomy-term=concepts><span class=taxonomy-label>Concepts</span><span class=taxonomy-count>11</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/containers/ data-taxonomy-term=containers><span class=taxonomy-label>Containers</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/control-plane-disconnect/ data-taxonomy-term=control-plane-disconnect><span class=taxonomy-label>Control Plane Disconnect</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/data-store/ data-taxonomy-term=data-store><span class=taxonomy-label>Data Store</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/domain/ data-taxonomy-term=domain><span class=taxonomy-label>Domain</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/event-types/ data-taxonomy-term=event-types><span class=taxonomy-label>Event Types</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/events/ data-taxonomy-term=events><span class=taxonomy-label>Events</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/failover/ data-taxonomy-term=failover><span class=taxonomy-label>Failover</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/help/ data-taxonomy-term=help><span class=taxonomy-label>Help</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/layer-4/ data-taxonomy-term=layer-4><span class=taxonomy-label>Layer 4</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/networking/ data-taxonomy-term=networking><span class=taxonomy-label>Networking</span><span class=taxonomy-count>8</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/node/ data-taxonomy-term=node><span class=taxonomy-label>Node</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/overview/ data-taxonomy-term=overview><span class=taxonomy-label>Overview</span><span class=taxonomy-count>2</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/rewrite/ data-taxonomy-term=rewrite><span class=taxonomy-label>Rewrite</span><span class=taxonomy-count>7</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/s3/ data-taxonomy-term=s3><span class=taxonomy-label>S3</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/tag/ data-taxonomy-term=tag><span class=taxonomy-label>Tag</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/troubleshoot/ data-taxonomy-term=troubleshoot><span class=taxonomy-label>Troubleshoot</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/tunnels/ data-taxonomy-term=tunnels><span class=taxonomy-label>Tunnels</span><span class=taxonomy-count>5</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/upgrade-manager/ data-taxonomy-term=upgrade-manager><span class=taxonomy-label>Upgrade Manager</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/virtual-machines/ data-taxonomy-term=virtual-machines><span class=taxonomy-label>Virtual Machines</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/vrfs/ data-taxonomy-term=vrfs><span class=taxonomy-label>VRFs</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=https://docs.trustgrid.io/tags/ztna/ data-taxonomy-term=ztna><span class=taxonomy-label>Ztna</span><span class=taxonomy-count>8</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/tutorials/>Guides</a></li><li class=breadcrumb-item><a href=/tutorials/deployments/>Appliance Deployments</a></li><li class=breadcrumb-item><a href=/tutorials/deployments/deploy-azure/>Deploy to Azure</a></li><li class="breadcrumb-item active" aria-current=page>AZ CLI Deployment</li></ol></nav><div class=td-content><h1>Azure CLI (az) Deployment</h1><div class=lead>Details how to deploy a Trustgrid appliance and related resources using the Azure CLI (az) commands.</div><header class=article-meta><p class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>&nbsp; 9 minute read &nbsp;</p></header><p>Deploying the Trustgrid appliance requires certain resources to be created in Azure before the appliance VM can be deployed. This guide will walk through deploying those prerequisite resources using the Azure CLI (az) commands and then deploying the Trustgrid appliance VM itself.</p><p>See <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/>AZ CLI Example Walkthrough</a> to see the output of running the below commands, and see how you could create the <a href=/tutorials/deployments/deploy-azure/#azure-requirements>Azure Appliance Requirements</a> with the <code>az</code> cli in advance if they do not exist.</p><h2 id=prerequisites>Prerequisites</h2><p>In addition to the <a href=/tutorials/deployments/deploy-azure/#azure-requirements>Azure Appliance Requirements</a> you will need:</p><ul><li><a href=https://learn.microsoft.com/en-us/cli/azure/install-azure-cli>Azure CLI installed</a> or access to <a href="https://learn.microsoft.com/en-us/azure/cloud-shell/get-started?tabs=azurecli">Azure Cloud Shell</a> and logged in with <code>az login</code></li><li>SSH public key</li></ul><h2 id=deploy-azure-vm-as-trustgrid-appliance>Deploy Azure VM as Trustgrid Appliance</h2><p>First, Ensure you are authenticated to Azure and have selected the desired subscript using <code>az account set --subscription "MySubscription"</code> and ensure all the <a href=/tutorials/deployments/deploy-azure/#azure-requirements>Azure Appliance Requirements</a> exist before proceeding.</p><h3 id=declare-required-variables>Declare Required Variables</h3><div class="alert alert-info" role=alert>The below commands are presented in Bash syntax for compatibility with other operating systems. The Azure Cloud Shell can be changed to Bash mode, but if you prefer Powershell you&rsquo;ll need to remove the <code>export</code> part of the command and add a <code>$</code> to each variable name. e.g. <code>export location="centralus"</code> needs to be input as <code>$location="centralus"</code></div><table><thead><tr><th>Variable</th><th>Example Bash Command</th><th>Description</th></tr></thead><tbody><tr><td>location</td><td><code>export location="centralus"</code></td><td><ul><li>Change <strong>centralus</strong> to the desired Azure region for deploying resources</li><li>See the table of <a href=/tutorials/deployments/deploy-azure/#supported-regions>supported regions</a> for locations with the required Trustgrid image published</li></td></tr><tr><td>resourceGroup</td><td><code>export resourceGroup="myResourceGroup"</code></td><td>Change <strong>myResourceGroup</strong> to the name of your target resource group</td></tr><tr><td>vNetName</td><td><code>export vNetName="myVnet"</code></td><td>Change <strong>myVnet</strong> to the name of your target virtual network where the Trustgrid appliance will be connected</td></tr><tr><td>outsideSubnet</td><td><code>export outsideSubnet="outside"</code></td><td>Change <strong>outside</strong> to the name of your target WAN subnet. This must exist in the virtual network defined by myVnetName</td></tr><tr><td>insideSubnet</td><td><code>export insideSubnet="inside"</code></td><td>Change <strong>inside</strong> to the name of your target LAN subnet. This must exist in the virtual network defined by myVnetName</td></tr><tr><td>name</td><td><code>export name="myNode"</code></td><td>Change <strong>myNode</strong> to the desired name of your Trustgrid appliance virtual machine being created</td></tr><tr><td>size</td><td><code>export size="Standard_B2s"</code></td><td>Change <strong>Standard_B2s</strong> to the desired VM size. See <a href=/tutorials/deployments/deploy-azure/#instance-size>Instance sizes</a> for supported options and sizing recommendation.</td></tr><tr><td>osDiskSize</td><td><code>export osDiskSize=30</code></td><td>Change <strong>30</strong> to the desired size in GB for the OS disk. Minimum recommended is 30GB.</td></tr></tbody></table><p>Here are all the commands together without values so that you can copy (a button will appear if you hover in the top right), edit and paste into your terminal.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>location</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>resourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>vNetName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>outsideSubnet</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>insideSubnet</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>size</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Standard_B2s&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>osDiskSize</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>30</span>
</span></span></code></pre></div><h3 id=capture-latest-trustgrid-image-id>Capture Latest Trustgrid Image ID</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>imageID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>az sig image-version list-community <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --public-gallery-name trustgrid-45680719-9aa7-43b9-a376-dc03bcfdb0ac <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --gallery-image-definition trustgrid-node-2204-prod <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --location <span style=color:#000>$location</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --output json 2&gt;/dev/null <span style=color:#000;font-weight:700>|</span> jq -r <span style=color:#4e9a06>&#39;sort_by(.name)| reverse | .[0].uniqueId&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span></code></pre></div><p>The above command sets <code>imageID</code> to the latest Trustgrid image ID from the Trustgrid image gallery in the Azure region specified by <code>location</code>.</p><p>You can use the command <code>echo $imageID</code> to see the result. it should look something like the below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sales@Azure:~$ <span style=color:#204a87>echo</span> <span style=color:#000>$imageID</span>
</span></span><span style=display:flex><span>/CommunityGalleries/trustgrid-45680719-9aa7-43b9-a376-dc03bcfdb0ac/Images/trustgrid-node-2204-prod/Versions/2.17.1
</span></span></code></pre></div><h3 id=prepare-ssh-key-in-azure>Prepare SSH Key in Azure</h3><p>After registration, SSH is only accessible via the Trustgrid portal, but Azure requires an SSH key to be associated with the VM to allow SSH access on creation.</p><p>There are a few ways to handle this in Azure, but it is important you end up with a variable <code>sshKeyName</code> containing the name of an existing SSH key resource in Azure.</p><div class="alert alert-info" role=alert>The SSH public keys in the examples below are not valid and are for demonstration purposes only.</div><h4 id=reference-an-existing-azure-ssh-key-resource>Reference an Existing Azure SSH key resource</h4><p>If you have an existing SSH key resource in Azure you can export its name as a variable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>sshKeyName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;MyKeyName&#34;</span>
</span></span></code></pre></div><h4 id=create-new-key-and-azure-ssh-key-resource>Create new key and Azure SSH key resource</h4><p>The below example creates a new SSH key pair and uses that to create a new Azure SSH key resource associated with the resource group:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sales@Azure:~$ <span style=color:#204a87>export</span> <span style=color:#000>sshKeyName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;myNewSSHKey&#34;</span>
</span></span><span style=display:flex><span>az sshkey create --name <span style=color:#000>$sshKeyName</span> --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span>
</span></span><span style=display:flex><span>No public key is provided. A key pair is being generated <span style=color:#204a87;font-weight:700>for</span> you.
</span></span><span style=display:flex><span>Private key is saved to <span style=color:#4e9a06>&#34;/home/sales/.ssh/1698355223_61326&#34;</span>.
</span></span><span style=display:flex><span>Public key is saved to <span style=color:#4e9a06>&#34;/home/sales/.ssh/1698355223_61326.pub&#34;</span>.
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;id&#34;</span>: <span style=color:#4e9a06>&#34;/subscriptions/#######-####-####-####-#########/resourceGroups/DOCSEXAMPLE/providers/Microsoft.Compute/sshPublicKeys/myNewSSHKey&#34;</span>,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;location&#34;</span>: <span style=color:#4e9a06>&#34;eastus&#34;</span>,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;myNewSSHKey&#34;</span>,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;publicKey&#34;</span>: <span style=color:#4e9a06>&#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= generated-by-azure&#34;</span>,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;resourceGroup&#34;</span>: <span style=color:#4e9a06>&#34;DOCSEXAMPLE&#34;</span>,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;tags&#34;</span>: null,
</span></span><span style=display:flex><span> <span style=color:#4e9a06>&#34;type&#34;</span>: null
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><div class="alert alert-warning" role=alert>Note the location where the Private key was saved and ensure you save that key somewhere secure just in case SSH access is required later. Without the Private key, the public key is unusable.</div><p>Here is the command without output or values</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az sshkey create --name <span style=color:#000>$sshKeyName</span> --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span>
</span></span></code></pre></div><h4 id=create-new-azure-ssh-key-resource-with-existing-public-key>Create new Azure SSH Key resource with existing public key</h4><p>If you have an existing SSH key pair already, you can import the public key to create a new Azure SSH key resource:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sales@Azure:~$ az sshkey create --name <span style=color:#000>$sshKeyName</span> --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span> --public-key <span style=color:#4e9a06>&#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= existing-key&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;id&#34;</span>: <span style=color:#4e9a06>&#34;/subscriptions/#######-####-####-####-#########/resourceGroups/DOCSEXAMPLE/providers/Microsoft.Compute/sshPublicKeys/myNewSSHKey&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;location&#34;</span>: <span style=color:#4e9a06>&#34;eastus&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;myNewSSHKey&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;publicKey&#34;</span>: <span style=color:#4e9a06>&#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= existing-key&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;resourceGroup&#34;</span>: <span style=color:#4e9a06>&#34;DOCSEXAMPLE&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;tags&#34;</span>: null,
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;type&#34;</span>: null
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Here is the command without output or values</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az sshkey create --name <span style=color:#000>$sshKeyName</span> --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span> --public-key <span style=color:#4e9a06>&#34;&#34;</span>
</span></span></code></pre></div><h3 id=create-network-interfaces>Create Network Interfaces</h3><p>This step will create the network interfaces for the Trustgrid appliance VM to connect to the subnets. As part of this process, we will create these additional resources:</p><ul><li>Public IP for the outside interface.</li><li>Network Security Group for the outside interface and an explicit Outbound rule for the <a href=/help-center/kb/site-requirements/#trustgrid-control-plane>required connectivity to the Trustgrid Control Plane</a>. Additional rules will need to be added to allow the node to connect to:<ul><li>Outbound rules for data plane gateway IPs and ports if the appliance is acting as an edge/client device</li><li>Inbound rules if the appliance will be acting as a data plane or ZTNA gateway</li></ul></li><li>Network Security Group for the inside interface with no additional rules. After deployment, this security group could be extended to allow for required communication to internal resources.</li></ul><div class="alert alert-info" role=alert>Both security groups will be created with the <a href=https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview#default-security-rules>default security group rules</a></div><p>Here are the commands without output</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az network public-ip create --name <span style=color:#000>$name</span>-pubIP <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --sku <span style=color:#4e9a06>&#34;Standard&#34;</span> --allocation-method <span style=color:#4e9a06>&#34;Static&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az network nsg create --name <span style=color:#000>$name</span>-outside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az network nsg rule create --name <span style=color:#4e9a06>&#34;TGControlPlaneTCP&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --nsg-name <span style=color:#000>$name</span>-outside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --priority <span style=color:#0000cf;font-weight:700>1000</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --access <span style=color:#4e9a06>&#39;Allow&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --description <span style=color:#4e9a06>&#39;TCP ports required Trustgrid Control Plane networks&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --destination-address-prefixes <span style=color:#4e9a06>&#39;35.171.100.16/28&#39;</span> <span style=color:#4e9a06>&#39;34.223.12.192/28&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --destination-port-ranges <span style=color:#0000cf;font-weight:700>443</span> <span style=color:#0000cf;font-weight:700>8443</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --direction <span style=color:#4e9a06>&#39;Outbound&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --protocol <span style=color:#4e9a06>&#39;Tcp&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az network nsg create --name <span style=color:#000>$name</span>-inside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> --location <span style=color:#000>$location</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>az network nic create --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span> --location <span style=color:#000>$location</span> --name <span style=color:#000>$name</span>-outside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --vnet-name <span style=color:#000>$vNetName</span> --subnet <span style=color:#000>$outsideSubnet</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --accelerated-networking <span style=color:#204a87>false</span> --public-ip-address <span style=color:#000>$name</span>-pubIP <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network-security-group <span style=color:#000>$name</span>-outside
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>az network nic create --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --location <span style=color:#000>$location</span> --name <span style=color:#000>$name</span>-inside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --vnet-name <span style=color:#000>$vNetName</span> --subnet <span style=color:#000>$insideSubnet</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --accelerated-networking <span style=color:#204a87>false</span> --ip-forwarding <span style=color:#204a87>true</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --network-security-group <span style=color:#000>$name</span>-inside
</span></span></code></pre></div><p>See the example output for all of the above commands in the <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/#create-network-interfaces>AZ CLI Example Walkthrough</a></p><h3 id=create-trustgrid-appliance-vm>Create Trustgrid Appliance VM</h3><p>Finally, we can deploy the actual VM with the two below commands</p><p>This command creates the VM:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az vm create <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --name <span style=color:#000>$name</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --image <span style=color:#000>$imageID</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --accept-term <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --admin-user <span style=color:#4e9a06>&#39;ubuntu&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --assign-identity <span style=color:#4e9a06>&#39;[system]&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --authentication-type <span style=color:#4e9a06>&#39;ssh&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --nics <span style=color:#000>$name</span>-outside <span style=color:#000>$name</span>-inside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --nic-delete-option <span style=color:#4e9a06>&#39;Delete&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --os-disk-size-gb <span style=color:#000>$osDiskSize</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --os-disk-delete-option <span style=color:#4e9a06>&#39;Delete&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --size <span style=color:#000>$size</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --ssh-key-name <span style=color:#000>$sshKeyName</span>
</span></span></code></pre></div><p>This command enables boot diagnostics so that the serial console can be accessed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az vm boot-diagnostics <span style=color:#204a87>enable</span> --name <span style=color:#000>$name</span> --resource-group <span style=color:#000>$resourceGroup</span> 
</span></span></code></pre></div><p>See the example output in the <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/#create-trustgrid-appliance-vm>AZ CLI Example Walkthrough</a></p><h3 id=get-mac-address>Get MAC Address</h3><p>To make <a href=/tutorials/local-console-utility/#logging-in>Console login</a> easier run the below command to get the outside interface&rsquo;s MAC address:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az network nic show --name <span style=color:#000>$name</span>-outside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;.macAddress&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>   sed <span style=color:#4e9a06>&#39;s/-/:/g&#39;</span> <span style=color:#000;font-weight:700>|</span> tr <span style=color:#4e9a06>&#39;A-F&#39;</span> <span style=color:#4e9a06>&#39;a-f&#39;</span>
</span></span></code></pre></div><p>Example output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sales@Azure:~$ az network nic show --name <span style=color:#000>$name</span>-outside <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>  --resource-group <span style=color:#000>$resourceGroup</span> <span style=color:#000;font-weight:700>|</span> jq <span style=color:#4e9a06>&#39;.macAddress&#39;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>   sed <span style=color:#4e9a06>&#39;s/-/:/g&#39;</span> <span style=color:#000;font-weight:700>|</span> tr <span style=color:#4e9a06>&#39;A-F&#39;</span> <span style=color:#4e9a06>&#39;a-f&#39;</span>
</span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;00:0d:3a:9d:a3:2d&#34;</span>
</span></span></code></pre></div><h3 id=register-the-vm>Register the VM</h3><p>You can now start the <a href=/tutorials/local-console-utility/remote-registration/>console registration process</a> and if you have portal access complete the activation process.</p><h2 id=additional-steps-for-ha-clusters>Additional Steps for HA Clusters</h2><p>If deploying an HA cluster there are additional steps required:</p><h3 id=create-additional-vm-appliance>Create Additional VM Appliance</h3><p>Repeat the steps above to deploy a second VM appliance using different names but in the same resource group and vNet. This will be the secondary node in the HA cluster.</p><p>Assuming you still have the same variables declared from the above deployment you will just need to update the <code>$name</code> variable to a new value like shown in the example below.</p><pre tabindex=0><code>export name=&#34;newName&#34;
</code></pre><p>Then you can proceed with creating the <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/#create-network-interfaces>network interface resources</a> and then <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/#create-trustgrid-appliance-vm>create the vm appliance</a>.</p><h3 id=create-role-for-route-management>Create Role for Route Management</h3><p>The steps below create a custom role that has permission to manipulate route tables:</p><p>First, download the template JSON file to your environment.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -o tg-route-role.json https://raw.githubusercontent.com/trustgrid/trustgrid-infra-as-code/main/azure/resources/cluster-role-template/tg-route-role.json
</span></span></code></pre></div><p>Use the command below to get your subscription ID:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az account show --query id -o tsv
</span></span></code></pre></div><p>Use an editor such as <code>vi</code> or <code>nano</code> to modify the template and replace the placeholders <code>REPLACE</code> in the template with your subscription ID.</p><p>Or, you can perform both the above steps in a single command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -i <span style=color:#4e9a06>&#34;s/REPLACE/</span><span style=color:#204a87;font-weight:700>$(</span>az account show --query id -o tsv<span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>/g&#34;</span> tg-route-role.json
</span></span></code></pre></div><p>Optionally, you can edit the Name and Description fields as well.</p><p>Then create the role using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>az role definition create --role-definition @tg-route-role.json
</span></span></code></pre></div><p>See <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/#create-role-for-route-management>AZ CLI Example Walkthrough</a> for output.</p><div class="alert alert-info" role=alert>The role created above can only be assigned to resources in the current subscription. If your Azure account topology requires the Trustgrid appliance to be able to manage route tables in other subscriptions you&rsquo;ll need to create the role in those accounts as well and assign (see below) the role accordingly.</div><h3 id=assign-role-for-route-management>Assign Role for Route Management</h3><p>Finally, we need to assign this role. Below are the commands to perform this process without values for the names of the two VMs (vm1 and vm2) for the resource group.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>vm1</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>vm2</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>resourceGroup</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>roleName</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Trustgrid HA Route Role&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>subscription</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>az account show --query id -o tsv<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>vm1ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>az vm show --name <span style=color:#000>$vm1</span> --resource-group <span style=color:#000>$resourceGroup</span> --query <span style=color:#4e9a06>&#39;identity.principalId&#39;</span> -o tsv<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>vm2ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>az vm show --name <span style=color:#000>$vm2</span> --resource-group <span style=color:#000>$resourceGroup</span> --query <span style=color:#4e9a06>&#39;identity.principalId&#39;</span> -o tsv<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>roleID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>az role definition list --query <span style=color:#4e9a06>&#34;[?roleName==&#39;</span><span style=color:#000>$roleName</span><span style=color:#4e9a06>&#39;].name | [0]&#34;</span> -o tsv<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>az role assignment create --role <span style=color:#4e9a06>&#34;Trustgrid HA Route Role&#34;</span> --assignee <span style=color:#000>$vm1ID</span> --scope <span style=color:#4e9a06>&#34;/subscriptions/</span><span style=color:#000>$subscription</span><span style=color:#4e9a06>/resourceGroups/</span><span style=color:#000>$resourceGroup</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>az role assignment create --role <span style=color:#4e9a06>&#34;Trustgrid HA Route Role&#34;</span> --assignee <span style=color:#000>$vm2ID</span> --scope <span style=color:#4e9a06>&#34;/subscriptions/</span><span style=color:#000>$subscription</span><span style=color:#4e9a06>/resourceGroups/</span><span style=color:#000>$resourceGroup</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p><div class="alert alert-warning" role=alert>The above assumes you didn&rsquo;t change the <code>Name</code> settings in the tg-route-role.json file when <a href=/#create-role-for-route-management>creating the role definition</a>. If you did you need to update the <code>roleName</code> variable before exporting.</div>See <a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/#assign-role-for-route-management>AZ CLI Example Walkthrough</a> for output.<div class="alert alert-info" role=alert>The above commands scope the role to the resource group that contains the node appliance VMs. If your Azure account and resource group topology requires the nodes to be able to update route tables in other resources groups you&rsquo;ll need to repeat the role assignment commands either at a higher level (like subscription) or with a different value for <code>resourceGroup</code>.</div></p><div class=section-index><hr class=panel-line><div class=entry><h5><a href=/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/>Example Walkthrough of Azure CLI (az) Deployment</a></h5><p>Shows how to create all prerequisite resources and the output of running the deployment commands</p></div></div><style>.feedback--answer{display:inline-block}.feedback--answer-no{margin-left:1em}.feedback--response{display:none;margin-top:1em}.feedback--response__visible{display:block}</style><div class=d-print-none><h2 class=feedback--title>Feedback</h2><p class=feedback--question>Was this page helpful?</p><button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button><p class="feedback--response feedback--response-yes">Glad to hear it! Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p><p class="feedback--response feedback--response-no">Sorry to hear that. Please <a href=https://github.com/trustgrid/docs/issues/new>tell us how we can improve</a>.</p></div><script>const yesButton=document.querySelector(".feedback--answer-yes"),noButton=document.querySelector(".feedback--answer-no"),yesResponse=document.querySelector(".feedback--response-yes"),noResponse=document.querySelector(".feedback--response-no"),disableButtons=()=>{yesButton.disabled=!0,noButton.disabled=!0},sendFeedback=e=>{if(typeof gtag!="function")return;gtag("event","page_helpful",{event_category:"Helpful",event_label:window.location.pathname,value:e})};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(100)}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback--response__visible"),disableButtons(),sendFeedback(0)})</script><br></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=LinkedIn aria-label=LinkedIn><a target=_blank rel=noopener href=https://www.linkedin.com/company/trustgrid/ aria-label=LinkedIn><i class="fab fa-linkedin"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/trustgrid/docs aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2025
<span class=td-footer__authors>Trustgrid</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://trustgrid.io target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>