<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>â€“ Deploy to Azure</title><link>https://docs.trustgrid.io/tutorials/deployments/deploy-azure/</link><description>Recent content in Deploy to Azure on</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/index.xml" rel="self" type="application/rss+xml"/><item><title>Tutorials: Azure CLI (az) Deployment</title><link>https://docs.trustgrid.io/tutorials/deployments/deploy-azure/azure-cli-deployment/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.trustgrid.io/tutorials/deployments/deploy-azure/azure-cli-deployment/</guid><description>
&lt;p>Deploying the Trustgrid appliance requires certain resources to be created in Azure before the appliance VM can be deployed. This guide will walk through deploying those prerequisite resources using the Azure CLI (az) commands and then deploying the Trustgrid appliance VM itself.&lt;/p>
&lt;p>See &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/azure-cli-deployment/az-cli-example/">AZ CLI Example Walkthrough&lt;/a> to see the output of running the below commands, and see how you could create the &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/#azure-requirements">Azure Appliance Requirements&lt;/a> with the &lt;code>az&lt;/code> cli in advance if they do not exist.&lt;/p>
&lt;h2 id="prerequisites">Prerequisites&lt;/h2>
&lt;p>In addition to the &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/#azure-requirements">Azure Appliance Requirements&lt;/a> you will need:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://learn.microsoft.com/en-us/cli/azure/install-azure-cli">Azure CLI installed&lt;/a> or access to &lt;a href="https://learn.microsoft.com/en-us/azure/cloud-shell/get-started?tabs=azurecli">Azure Cloud Shell&lt;/a> and logged in with &lt;code>az login&lt;/code>&lt;/li>
&lt;li>SSH public key&lt;/li>
&lt;/ul>
&lt;h2 id="deploy-azure-vm-as-trustgrid-appliance">Deploy Azure VM as Trustgrid Appliance&lt;/h2>
&lt;p>First, Ensure you are authenticated to Azure and have selected the desired subscript using &lt;code>az account set --subscription &amp;quot;MySubscription&amp;quot;&lt;/code> and ensure all the &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/#azure-requirements">Azure Appliance Requirements&lt;/a> exist before proceeding.&lt;/p>
&lt;h3 id="declare-required-variables">Declare Required Variables&lt;/h3>
&lt;div class="alert alert-info" role="alert">
The below commands are presented in Bash syntax for compatibility with other operating systems. The Azure Cloud Shell can be changed to Bash mode, but if you prefer Powershell you&amp;rsquo;ll need to remove the &lt;code>export&lt;/code> part of the command and add a &lt;code>$&lt;/code> to each variable name. e.g. &lt;code>export location=&amp;quot;centralus&amp;quot;&lt;/code> needs to be input as &lt;code>$location=&amp;quot;centralus&amp;quot;&lt;/code>
&lt;/div>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Example Bash Command&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>location&lt;/td>
&lt;td>&lt;code>export location=&amp;quot;centralus&amp;quot;&lt;/code>&lt;/td>
&lt;td>&lt;ul>&lt;li>Change &lt;strong>centralus&lt;/strong> to the desired Azure region for deploying resources&lt;/li>&lt;li>See the table of &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/#supported-regions">supported regions&lt;/a> for locations with the required Trustgrid image published&lt;/li>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>resourceGroup&lt;/td>
&lt;td>&lt;code>export resourceGroup=&amp;quot;myResourceGroup&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>myResourceGroup&lt;/strong> to the name of your target resource group&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>vNetName&lt;/td>
&lt;td>&lt;code>export vNetName=&amp;quot;myVnet&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>myVnet&lt;/strong> to the name of your target virtual network where the Trustgrid appliance will be connected&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>outsideSubnet&lt;/td>
&lt;td>&lt;code>export outsideSubnet=&amp;quot;outside&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>outside&lt;/strong> to the name of your target WAN subnet. This must exist in the virtual network defined by myVnetName&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>insideSubnet&lt;/td>
&lt;td>&lt;code>export insideSubnet=&amp;quot;inside&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>inside&lt;/strong> to the name of your target LAN subnet. This must exist in the virtual network defined by myVnetName&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>name&lt;/td>
&lt;td>&lt;code>export name=&amp;quot;myNode&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>myNode&lt;/strong> to the desired name of your Trustgrid appliance virtual machine being created&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>size&lt;/td>
&lt;td>&lt;code>export size=&amp;quot;Standard_B2s&amp;quot;&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>Standard_B2s&lt;/strong> to the desired VM size. See &lt;a href="https://docs.trustgrid.io/tutorials/deployments/deploy-azure/#instance-size">Instance sizes&lt;/a> for supported options and sizing recommendation.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>osDiskSize&lt;/td>
&lt;td>&lt;code>export osDiskSize=30&lt;/code>&lt;/td>
&lt;td>Change &lt;strong>30&lt;/strong> to the desired size in GB for the OS disk. Minimum recommended is 30GB.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Here are all the commands together without values so that you can copy (a button will appear if you hover in the top right), edit and paste into your terminal.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">location&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">resourceGroup&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">vNetName&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">outsideSubnet&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">insideSubnet&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">name&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">size&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;Standard_B2s&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">osDiskSize&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">30&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="capture-latest-trustgrid-image-id">Capture Latest Trustgrid Image ID&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">imageID&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>az sig image-version list-community &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --public-gallery-name trustgrid-45680719-9aa7-43b9-a376-dc03bcfdb0ac &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --gallery-image-definition trustgrid-node-2204-prod &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --output json 2&amp;gt;/dev/null &lt;span style="color:#000;font-weight:bold">|&lt;/span> jq -r &lt;span style="color:#4e9a06">&amp;#39;sort_by(.name)| reverse | .[0].uniqueId&amp;#39;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>The above command sets &lt;code>imageID&lt;/code> to the latest Trustgrid image ID from the Trustgrid image gallery in the Azure region specified by &lt;code>location&lt;/code>.&lt;/p>
&lt;p>You can use the command &lt;code>echo $imageID&lt;/code> to see the result. it should look something like the below:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sales@Azure:~$ &lt;span style="color:#204a87">echo&lt;/span> &lt;span style="color:#000">$imageID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>/CommunityGalleries/trustgrid-45680719-9aa7-43b9-a376-dc03bcfdb0ac/Images/trustgrid-node-2204-prod/Versions/2.17.1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="prepare-ssh-key-in-azure">Prepare SSH Key in Azure&lt;/h3>
&lt;p>After registration SSH is only accessible via the Trustgrid portal, but Azure requires an SSH key be associated with the VM to allow SSH access on creation.&lt;/p>
&lt;p>There are a few ways to handle this in Azure, but it is important you end up with a variable &lt;code>sshKeyName&lt;/code> containing the name of an existing SSH key resource in Azure.&lt;/p>
&lt;div class="alert alert-info" role="alert">
The SSH public keys in examples below are not valid and are for demonstration purposes only.
&lt;/div>
&lt;h4 id="reference-an-existing-azure-ssh-key-resource">Reference an Existing Azure SSH key resource&lt;/h4>
&lt;p>If you have an existing SSH key resource in Azure you can export its name as a variable:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">sshKeyName&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;MyKeyName&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="create-new-key-and-azure-ssh-key-resource">Create new key and Azure SSH key resource&lt;/h4>
&lt;p>The below example creates a new SSH key pair and uses that to create a new Azure SSH key resource associated with the resource group:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sales@Azure:~$ &lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">sshKeyName&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;myNewSSHKey&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az sshkey create --name &lt;span style="color:#000">$sshKeyName&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>No public key is provided. A key pair is being generated &lt;span style="color:#204a87;font-weight:bold">for&lt;/span> you.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Private key is saved to &lt;span style="color:#4e9a06">&amp;#34;/home/sales/.ssh/1698355223_61326&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Public key is saved to &lt;span style="color:#4e9a06">&amp;#34;/home/sales/.ssh/1698355223_61326.pub&amp;#34;&lt;/span>.
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;/subscriptions/#######-####-####-####-#########/resourceGroups/DOCSEXAMPLE/providers/Microsoft.Compute/sshPublicKeys/myNewSSHKey&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;location&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;eastus&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;name&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;myNewSSHKey&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;publicKey&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= generated-by-azure&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;resourceGroup&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;DOCSEXAMPLE&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;tags&amp;#34;&lt;/span>: null,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;type&amp;#34;&lt;/span>: null
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="alert alert-warning" role="alert">
Note the location where the Private key was saved and ensure you save that key somewhere secure just in case SSH access is required later. Without the Private key, the public key is unusable.
&lt;/div>
&lt;p>Here is the command without output or values&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az sshkey create --name &lt;span style="color:#000">$sshKeyName&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="create-new-azure-ssh-key-resource-with-existing-public-key">Create new Azure SSH Key resource with existing public key&lt;/h4>
&lt;p>If you have an existing SSH key pair already, you can import the public key to create a new Azure SSH key resource:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sales@Azure:~$ az sshkey create --name &lt;span style="color:#000">$sshKeyName&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> --public-key &lt;span style="color:#4e9a06">&amp;#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= existing-key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;id&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;/subscriptions/#######-####-####-####-#########/resourceGroups/DOCSEXAMPLE/providers/Microsoft.Compute/sshPublicKeys/myNewSSHKey&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;location&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;eastus&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;name&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;myNewSSHKey&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;publicKey&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC6fak3eFAKEKEY8uRMxw+GfkT4xFGkUlFakeyDTNeM59C3z7g1cTtABCDEF12345678910ABCDksVaNfFakeKeyInHere+UoXUQtDZghF38I6t7S58xvZX7Gdr+W4qvlhLP7YYQXdMwFakEyXoS+ZrmdFakeyZZFakeKeyi2V8U1tzlvF5M= existing-key&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;resourceGroup&amp;#34;&lt;/span>: &lt;span style="color:#4e9a06">&amp;#34;DOCSEXAMPLE&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;tags&amp;#34;&lt;/span>: null,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#4e9a06">&amp;#34;type&amp;#34;&lt;/span>: null
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ce5c00;font-weight:bold">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here is the command without output or values&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az sshkey create --name &lt;span style="color:#000">$sshKeyName&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> --public-key &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="create-network-interfaces">Create Network Interfaces&lt;/h3>
&lt;p>This step will create the network interfaces for the Trustgrid appliance VM to connect to the subnets. As part of this process we will create these additional resources:&lt;/p>
&lt;ul>
&lt;li>Public IP for the outside interface.&lt;/li>
&lt;li>Network Security Group for the outside interface and an explicit Outbound rule for the &lt;a href="https://docs.trustgrid.io/help-center/kb/site-requirements/#trustgrid-control-plane">required connectivity to the Trustgrid Control Plane&lt;/a>. Additional rules will need to be added to allow the node to connect to:
&lt;ul>
&lt;li>Outbound rules for data plane gateway IPs and ports if the appliance is acting as an edge/client device&lt;/li>
&lt;li>Inbound rules if the appliance will be acting as a data plane or ZTNA gateway&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Network Security Group for the inside interface with no additional rules. After deployment this security group could be extended to allow for required communication to internal resources.&lt;/li>
&lt;/ul>
&lt;div class="alert alert-info" role="alert">
Both security groups will be created with the &lt;a href="https://learn.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview#default-security-rules">default security group rules&lt;/a>
&lt;/div>
&lt;p>Here are the commands without output&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az network public-ip create --name &lt;span style="color:#000">$name&lt;/span>-pubIP &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --sku &lt;span style="color:#4e9a06">&amp;#34;Standard&amp;#34;&lt;/span> --allocation-method &lt;span style="color:#4e9a06">&amp;#34;Static&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az network nsg create --name &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az network nsg rule create --name &lt;span style="color:#4e9a06">&amp;#34;TGControlPlaneTCP&amp;#34;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --nsg-name &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --priority &lt;span style="color:#0000cf;font-weight:bold">1000&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --access &lt;span style="color:#4e9a06">&amp;#39;Allow&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --description &lt;span style="color:#4e9a06">&amp;#39;TCP ports required Trustgrid Control Plane networks&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --destination-address-prefixes &lt;span style="color:#4e9a06">&amp;#39;35.171.100.16/28&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;34.223.12.192/28&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --destination-port-ranges &lt;span style="color:#0000cf;font-weight:bold">443&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">8443&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --direction &lt;span style="color:#4e9a06">&amp;#39;Outbound&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --protocol &lt;span style="color:#4e9a06">&amp;#39;Tcp&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az network nsg create --name &lt;span style="color:#000">$name&lt;/span>-inside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --location &lt;span style="color:#000">$location&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az network nic create --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> --name &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --vnet-name &lt;span style="color:#000">$vNetName&lt;/span> --subnet &lt;span style="color:#000">$outsideSubnet&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --accelerated-networking &lt;span style="color:#204a87">false&lt;/span> --public-ip-address &lt;span style="color:#000">$name&lt;/span>-pubIP &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --network-security-group &lt;span style="color:#000">$name&lt;/span>-outside
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az network nic create --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --location &lt;span style="color:#000">$location&lt;/span> --name &lt;span style="color:#000">$name&lt;/span>-inside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --vnet-name &lt;span style="color:#000">$vNetName&lt;/span> --subnet &lt;span style="color:#000">$insideSubnet&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --accelerated-networking &lt;span style="color:#204a87">false&lt;/span> --ip-forwarding &lt;span style="color:#204a87">true&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --network-security-group &lt;span style="color:#000">$name&lt;/span>-inside
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See example output for all of the above commands in the &lt;a href="./az-cli-example/#create-network-interfaces">AZ CLI Example Walkthrough&lt;/a>&lt;/p>
&lt;h3 id="create-trustgrid-appliance-vm">Create Trustgrid Appliance VM&lt;/h3>
&lt;p>Finally we can deploy the actual VM with the two below commands&lt;/p>
&lt;p>This command creates the VM:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az vm create &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --name &lt;span style="color:#000">$name&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --image &lt;span style="color:#000">$imageID&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --accept-term &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --admin-user &lt;span style="color:#4e9a06">&amp;#39;ubuntu&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --assign-identity &lt;span style="color:#4e9a06">&amp;#39;[system]&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --authentication-type &lt;span style="color:#4e9a06">&amp;#39;ssh&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --nics &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#000">$name&lt;/span>-inside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --nic-delete-option &lt;span style="color:#4e9a06">&amp;#39;Delete&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --os-disk-size-gb &lt;span style="color:#000">$osDiskSize&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --os-disk-delete-option &lt;span style="color:#4e9a06">&amp;#39;Delete&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --size &lt;span style="color:#000">$size&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --ssh-key-name &lt;span style="color:#000">$sshKeyName&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>And this command enables boot diagnostics so that the serial console can be accessed.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az vm boot-diagnostics &lt;span style="color:#204a87">enable&lt;/span> --name &lt;span style="color:#000">$name&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See example output in the &lt;a href="./az-cli-example/#create-trustgrid-appliance-vm">AZ CLI Example Walkthrough&lt;/a>&lt;/p>
&lt;h3 id="get-mac-address">Get MAC Address&lt;/h3>
&lt;p>To make &lt;a href="https://docs.trustgrid.io/tutorials/local-console-utility/#logging-in">Console login&lt;/a> easier run the below command to get the outside interface&amp;rsquo;s MAC address:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az network nic show --name &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> jq &lt;span style="color:#4e9a06">&amp;#39;.macAddress&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> sed &lt;span style="color:#4e9a06">&amp;#39;s/-/:/g&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> tr &lt;span style="color:#4e9a06">&amp;#39;A-F&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;a-f&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Example output:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sales@Azure:~$ az network nic show --name &lt;span style="color:#000">$name&lt;/span>-outside &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> jq &lt;span style="color:#4e9a06">&amp;#39;.macAddress&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> &lt;span style="color:#4e9a06">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&lt;/span> sed &lt;span style="color:#4e9a06">&amp;#39;s/-/:/g&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">|&lt;/span> tr &lt;span style="color:#4e9a06">&amp;#39;A-F&amp;#39;&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;a-f&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#4e9a06">&amp;#34;00:0d:3a:9d:a3:2d&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="register-the-vm">Register the VM&lt;/h3>
&lt;p>You can now start the &lt;a href="https://docs.trustgrid.io/tutorials/local-console-utility/remote-registration/">console registration process&lt;/a> and if you have portal access complete the activation process.&lt;/p>
&lt;h2 id="additional-steps-for-ha-clusters">Additional Steps for HA Clusters&lt;/h2>
&lt;p>If deploying an HA cluster there are additional steps required:&lt;/p>
&lt;h3 id="create-additional-vm-appliance">Create Additional VM Appliance&lt;/h3>
&lt;p>Repeat the steps above to deploy a second VM appliance using different names but in the same resource group and vNet. This will be the secondary node in the HA cluster.&lt;/p>
&lt;p>Assuming you still have the same variables declared from above deployment you will just need to update the &lt;code>$name&lt;/code> variable to a new value like shown in the example below.&lt;/p>
&lt;pre tabindex="0">&lt;code>export name=&amp;#34;newName&amp;#34;
&lt;/code>&lt;/pre>&lt;p>Then you can proceed with creating the &lt;a href="#create-network-interfaces">network interface resources&lt;/a> and then &lt;a href="#create-trustgrid-appliance-vm">create the vm appliance&lt;/a>.&lt;/p>
&lt;h3 id="create-role-for-route-management">Create Role for Route Management&lt;/h3>
&lt;p>The steps below create a custom role that has permissions to manipulate route tables:&lt;/p>
&lt;p>First, download the template json file to your environment.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -o tg-route-role.json https://raw.githubusercontent.com/trustgrid/trustgrid-infra-as-code/main/azure/resources/cluster-role-template/tg-route-role.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Use the command below to get your subscription ID:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az account show --query id -o tsv
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Use an editor such as &lt;code>vi&lt;/code> or &lt;code>nano&lt;/code> to modify the template and replace the placeholders &lt;code>REPLACE&lt;/code> in the template with your subscription ID.&lt;/p>
&lt;p>Or, you can perform both the above steps in a single command:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sed -i &lt;span style="color:#4e9a06">&amp;#34;s/REPLACE/&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>az account show --query id -o tsv&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>&lt;span style="color:#4e9a06">/g&amp;#34;&lt;/span> tg-route-role.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Optionally, you can edit the Name and Description fields as well.&lt;/p>
&lt;p>Then create the role using:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>az role definition create --role-definition @tg-route-role.json
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See &lt;a href="./az-cli-example/#create-role-for-route-management">AZ CLI Example Walkthrough&lt;/a> for output.&lt;/p>
&lt;div class="alert alert-info" role="alert">
The role created above can only be assigned to resources in the current subscription. If your Azure account topology requires the Trustgrid appliance to be able to manage route tables in other subscription you&amp;rsquo;ll need to create the role in those accounts as well and assign (see below) the role accordingly.
&lt;/div>
&lt;h3 id="assign-role-for-route-management">Assign Role for Route Management&lt;/h3>
&lt;p>Finally, we need to assign this role. Below provides the commands to perform this process without values for the names of the two VMs (vm1 and vm2) or for the resource group.&lt;/p>
&lt;p>Note, the &lt;code>az role assignement create&lt;/code> command does not seem to work with variables for the &lt;code>--role&lt;/code> parameter value. If you named your role something other than &amp;ldquo;Trustgrid HA Route Role&amp;rdquo; you&amp;rsquo;ll need to adjust the last two commands accordingly.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">vm1&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">vm2&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">resourceGroup&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">subscription&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>az account show --query id -o tsv&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">vm1ID&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>az vm show --name &lt;span style="color:#000">$vm1&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --query &lt;span style="color:#4e9a06">&amp;#39;identity.principalId&amp;#39;&lt;/span> -o tsv&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#204a87">export&lt;/span> &lt;span style="color:#000">vm2ID&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#204a87;font-weight:bold">$(&lt;/span>az vm show --name &lt;span style="color:#000">$vm2&lt;/span> --resource-group &lt;span style="color:#000">$resourceGroup&lt;/span> --query &lt;span style="color:#4e9a06">&amp;#39;identity.principalId&amp;#39;&lt;/span> -o tsv&lt;span style="color:#204a87;font-weight:bold">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az role assignment create --role &lt;span style="color:#4e9a06">&amp;#34;Trustgrid HA Route Role&amp;#34;&lt;/span> --assignee &lt;span style="color:#000">$vm1ID&lt;/span> --scope &lt;span style="color:#4e9a06">&amp;#34;/subscriptions/&lt;/span>&lt;span style="color:#000">$subscription&lt;/span>&lt;span style="color:#4e9a06">/resourceGroups/&lt;/span>&lt;span style="color:#000">$resourceGroup&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>az role assignment create --role &lt;span style="color:#4e9a06">&amp;#34;Trustgrid HA Route Role&amp;#34;&lt;/span> --assignee &lt;span style="color:#000">$vm2ID&lt;/span> --scope &lt;span style="color:#4e9a06">&amp;#34;/subscriptions/&lt;/span>&lt;span style="color:#000">$subscription&lt;/span>&lt;span style="color:#4e9a06">/resourceGroups/&lt;/span>&lt;span style="color:#000">$resourceGroup&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>See &lt;a href="./az-cli-example/#assign-role-for-route-management">AZ CLI Example Walkthrough&lt;/a> for output.
&lt;div class="alert alert-info" role="alert">
The above commands scope the role to the resource group that contains the node appliance VMs. IF your Azure account and resource group topology requires the nodes to be able to update route tables in other resources groups you&amp;rsquo;ll need to repeat the role assignment commands either at a higher level (like subscription) or with a different value for &lt;code>resourceGroup&lt;/code>.
&lt;/div>
&lt;/p></description></item></channel></rss>